<!-- ===== INÍCIO: BLOCO 1 ============================== -->
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema Financeiro Familiar</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<!-- ===== FIM: BLOCO 1 ================================ -->

<!-- ===== INÍCIO: BLOCO 2 ============================== -->
<body data-theme="light">
  <div class="app-container">
    <aside class="sidebar">
      <div class="sidebar-header">
        <h1 class="app-title">Sistema Financeiro</h1>
        <button id="theme-toggle" class="theme-toggle-btn">
          <i class="fas fa-moon"></i>
        </button>
      </div>
      <nav class="sidebar-nav">
        <ul class="nav-menu">
          <li class="nav-item active" data-module="dashboard">
            <i class="fas fa-home"></i>
            <span>Dashboard</span>
          </li>
          <li class="nav-item" data-module="monthly-analysis">
            <i class="fas fa-chart-bar"></i>
            <span>Análise Mensal</span>
          </li>
          <li class="nav-item" data-module="cash-projection">
            <i class="fas fa-chart-line"></i>
            <span>Projeção de Caixa</span>
          </li>
          <li class="nav-item" data-module="financial-goals">
            <i class="fas fa-bullseye"></i>
            <span>Metas Financeiras</span>
          </li>
          <li class="nav-item" data-module="settings">
            <i class="fas fa-cog"></i>
            <span>Configurações</span>
          </li>
        </ul>
      </nav>
    </aside>
<!-- ===== FIM: BLOCO 2 ================================ -->

<!-- ===== INÍCIO: BLOCO 3 ============================== -->
    <main class="main-content">
      <header class="content-header">
        <div class="header-left">
          <button id="toggle-sidebar" class="toggle-sidebar-btn">
            <i class="fas fa-bars"></i>
          </button>
          <h2 id="current-module-title">Dashboard</h2>
        </div>
        <div class="header-filters">
          <div class="filter-group">
            <select id="month-filter" class="filter-select">
              <!-- Preenchido via JavaScript -->
            </select>
          </div>
          <div class="filter-group">
            <select id="payment-filter" class="filter-select">
              <option value="all">Todas as formas de pagamento</option>
              <option value="cash">Dinheiro</option>
              <option value="debit">Débito</option>
              <option value="credit">Cartão de Crédito</option>
              <option value="pix">PIX</option>
              <option value="transfer">Transferência</option>
            </select>
          </div>
          <div class="filter-group">
            <select id="person-filter" class="filter-select">
              <option value="all">Todas as pessoas</option>
              <!-- Preenchido via JavaScript -->
            </select>
          </div>
        </div>
        <div class="header-actions">
          <button id="new-transaction-btn" class="btn btn-primary">
            <i class="fas fa-plus"></i>
            Nova Transação
          </button>
        </div>
      </header>
      <div class="content-area">
        <!-- Os módulos serão carregados dinamicamente aqui -->
      </div>
    </main>
<!-- ===== FIM: BLOCO 3 ================================ -->

<!-- ===== INÍCIO: BLOCO 4 ============================== -->
    <div id="transaction-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="modal-title">Nova Transação</h3>
          <button class="close-modal">&times;</button>
        </div>
        <div class="modal-body">
          <form id="transaction-form">
            <input type="hidden" id="transaction-id">
            <div class="form-group">
              <label for="transaction-description">Descrição</label>
              <input type="text" id="transaction-description" placeholder="Descreva a transação">
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="transaction-amount">Valor (R$)</label>
                <input type="number" id="transaction-amount" placeholder="0,00" step="0.01">
              </div>
              <div class="form-group">
                <label for="transaction-date">Data</label>
                <input type="date" id="transaction-date">
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="transaction-type">Tipo</label>
                <select id="transaction-type">
                  <option value="expense">Despesa</option>
                  <option value="income">Receita</option>
                </select>
              </div>
              <div class="form-group">
                <label for="transaction-category">Categoria</label>
                <select id="transaction-category">
                  <!-- Preenchido via JavaScript -->
                </select>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="transaction-payment-method">Forma de Pagamento</label>
                <select id="transaction-payment-method">
                  <option value="cash">Dinheiro</option>
                  <option value="debit">Débito</option>
                  <option value="credit">Cartão de Crédito</option>
                  <option value="pix">PIX</option>
                  <option value="transfer">Transferência</option>
                </select>
              </div>
              <div class="form-group">
                <label for="transaction-person">Pessoa</label>
                <select id="transaction-person">
                  <!-- Preenchido via JavaScript -->
                </select>
              </div>
            </div>
            <div class="form-row" id="credit-card-details" style="display: none;">
              <div class="form-group">
                <label for="transaction-card">Cartão</label>
                <select id="transaction-card">
                  <!-- Preenchido via JavaScript -->
                </select>
              </div>
              <div class="form-group">
                <label for="transaction-installments">Parcelas</label>
                <select id="transaction-installments">
                  <option value="1">À vista</option>
                  <option value="2">2x</option>
                  <option value="3">3x</option>
                  <option value="4">4x</option>
                  <option value="5">5x</option>
                  <option value="6">6x</option>
                  <option value="7">7x</option>
                  <option value="8">8x</option>
                  <option value="9">9x</option>
                  <option value="10">10x</option>
                  <option value="11">11x</option>
                  <option value="12">12x</option>
                </select>
              </div>
            </div>
            <div class="form-group">
              <label for="transaction-priority">Prioridade</label>
              <select id="transaction-priority">
                <option value="low">Baixa</option>
                <option value="medium" selected>Média</option>
                <option value="high">Alta</option>
                <option value="essential">Essencial</option>
              </select>
            </div>
            <div class="form-group">
              <div class="checkbox-container">
                <input type="checkbox" id="transaction-recurrent">
                <label for="transaction-recurrent">Transação Recorrente</label>
              </div>
            </div>
            <div class="form-group" id="recurrent-details" style="display: none;">
              <label for="recurrent-frequency">Frequência</label>
              <select id="recurrent-frequency">
                <option value="monthly">Mensal</option>
                <option value="bimonthly">Bimestral</option>
                <option value="quarterly">Trimestral</option>
                <option value="semiannual">Semestral</option>
                <option value="annual">Anual</option>
              </select>
            </div>
            <div class="form-group">
              <label for="transaction-notes">Observações</label>
              <textarea id="transaction-notes" placeholder="Observações opcionais"></textarea>
            </div>
            <div class="form-actions">
              <button type="button" class="btn btn-secondary close-modal">Cancelar</button>
              <button type="submit" class="btn btn-primary">Salvar</button>
            </div>
          </form>
        </div>
      </div>
    </div>
<!-- ===== FIM: BLOCO 4 ================================ -->

<!-- ===== INÍCIO: BLOCO 5 ============================== -->
    <div id="category-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="category-modal-title">Nova Categoria</h3>
          <button class="close-modal">&times;</button>
        </div>
        <div class="modal-body">
          <form id="category-form">
            <input type="hidden" id="category-id">
            <div class="form-group">
              <label for="category-name">Nome</label>
              <input type="text" id="category-name" placeholder="Nome da categoria">
            </div>
            <div class="form-group">
              <label for="category-icon">Ícone</label>
              <div class="icon-selector">
                <div class="selected-icon" id="selected-icon">
                  <i class="fas fa-tag"></i>
                </div>
                <div class="icon-grid" id="icon-grid">
                  <div class="icon-item" data-icon="fa-home"><i class="fas fa-home"></i></div>
                  <div class="icon-item" data-icon="fa-shopping-cart"><i class="fas fa-shopping-cart"></i></div>
                  <div class="icon-item" data-icon="fa-utensils"><i class="fas fa-utensils"></i></div>
                  <div class="icon-item" data-icon="fa-car"><i class="fas fa-car"></i></div>
                  <div class="icon-item" data-icon="fa-plane"><i class="fas fa-plane"></i></div>
                  <div class="icon-item" data-icon="fa-bus"><i class="fas fa-bus"></i></div>
                  <div class="icon-item" data-icon="fa-tshirt"><i class="fas fa-tshirt"></i></div>
                  <div class="icon-item" data-icon="fa-pills"><i class="fas fa-pills"></i></div>
                  <div class="icon-item" data-icon="fa-graduation-cap"><i class="fas fa-graduation-cap"></i></div>
                  <div class="icon-item" data-icon="fa-gamepad"><i class="fas fa-gamepad"></i></div>
                  <div class="icon-item" data-icon="fa-gift"><i class="fas fa-gift"></i></div>
                  <div class="icon-item" data-icon="fa-glass-cheers"><i class="fas fa-glass-cheers"></i></div>
                  <div class="icon-item" data-icon="fa-dog"><i class="fas fa-dog"></i></div>
                  <div class="icon-item" data-icon="fa-baby"><i class="fas fa-baby"></i></div>
                  <div class="icon-item" data-icon="fa-money-bill-wave"><i class="fas fa-money-bill-wave"></i></div>
                  <div class="icon-item" data-icon="fa-hand-holding-usd"><i class="fas fa-hand-holding-usd"></i></div>
                  <div class="icon-item" data-icon="fa-piggy-bank"><i class="fas fa-piggy-bank"></i></div>
                  <div class="icon-item" data-icon="fa-donate"><i class="fas fa-donate"></i></div>
                  <div class="icon-item" data-icon="fa-credit-card"><i class="fas fa-credit-card"></i></div>
                </div>
                <input type="hidden" id="category-icon" value="fa-tag">
              </div>
            </div>
            <div class="form-group">
              <label for="category-color">Cor</label>
              <input type="color" id="category-color" value="#0A84FF">
            </div>
            <div class="form-actions">
              <button type="button" class="btn btn-secondary close-modal">Cancelar</button>
              <button type="submit" class="btn btn-primary">Salvar</button>
            </div>
          </form>
        </div>
      </div>
    </div>
<!-- ===== FIM: BLOCO 5 ================================ -->

<!-- ===== INÍCIO: BLOCO 6 ============================== -->
    <div id="person-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="person-modal-title">Nova Pessoa</h3>
          <button class="close-modal">&times;</button>
        </div>
        <div class="modal-body">
          <form id="person-form">
            <input type="hidden" id="person-id">
            <div class="form-group">
              <label for="person-name">Nome</label>
              <input type="text" id="person-name" placeholder="Nome da pessoa">
            </div>
            <div class="form-group">
              <label>Avatar</label>
              <div class="avatar-selector">
                <div class="selected-avatar" id="selected-avatar">
                  <div class="avatar-item" data-avatar="avatar-1"></div>
                </div>
                <div class="avatar-grid" id="avatar-grid">
                  <div class="avatar-item" data-avatar="avatar-1"></div>
                  <div class="avatar-item" data-avatar="avatar-2"></div>
                  <div class="avatar-item" data-avatar="avatar-3"></div>
                  <div class="avatar-item" data-avatar="avatar-4"></div>
                  <div class="avatar-item" data-avatar="avatar-5"></div>
                  <div class="avatar-item" data-avatar="avatar-6"></div>
                  <div class="avatar-item" data-avatar="avatar-7"></div>
                  <div class="avatar-item" data-avatar="avatar-8"></div>
                </div>
                <input type="hidden" id="person-avatar" value="avatar-1">
              </div>
            </div>
            <div class="form-actions">
              <button type="button" class="btn btn-secondary close-modal">Cancelar</button>
              <button type="submit" class="btn btn-primary">Salvar</button>
            </div>
          </form>
        </div>
      </div>
    </div>
<!-- ===== FIM: BLOCO 6 ================================ -->

<!-- ===== INÍCIO: BLOCO 7 ============================== -->
    <div id="card-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="card-modal-title">Novo Cartão</h3>
          <button class="close-modal">&times;</button>
        </div>
        <div class="modal-body">
          <form id="card-form">
            <input type="hidden" id="card-id">
            <div class="form-group">
              <label for="card-name">Nome do Cartão</label>
              <input type="text" id="card-name" placeholder="Nome do cartão">
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="card-limit">Limite (R$)</label>
                <input type="number" id="card-limit" placeholder="0,00" step="0.01">
              </div>
              <div class="form-group">
                <label for="card-closing-day">Dia de Fechamento</label>
                <input type="number" id="card-closing-day" min="1" max="31" placeholder="10">
              </div>
            </div>
            <div class="form-group">
              <label for="card-due-day">Dia de Vencimento</label>
              <input type="number" id="card-due-day" min="1" max="31" placeholder="15">
            </div>
            <div class="form-group">
              <label for="card-color">Cor</label>
              <input type="color" id="card-color" value="#FF453A">
            </div>
            <div class="form-actions">
              <button type="button" class="btn btn-secondary close-modal">Cancelar</button>
              <button type="submit" class="btn btn-primary">Salvar</button>
            </div>
          </form>
        </div>
      </div>
    </div>
<!-- ===== FIM: BLOCO 7 ================================ -->

<!-- ===== INÍCIO: BLOCO 8 ============================== -->
    <div id="goal-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="goal-modal-title">Nova Meta</h3>
          <button class="close-modal">&times;</button>
        </div>
        <div class="modal-body">
          <form id="goal-form">
            <input type="hidden" id="goal-id">
            <div class="form-group">
              <label for="goal-name">Nome da Meta</label>
              <input type="text" id="goal-name" placeholder="Nome da meta">
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="goal-target">Valor Alvo (R$)</label>
                <input type="number" id="goal-target" placeholder="0,00" step="0.01">
              </div>
              <div class="form-group">
                <label for="goal-deadline">Prazo Final</label>
                <input type="date" id="goal-deadline">
              </div>
            </div>
            <div class="form-group">
              <label for="goal-person">Destinatário</label>
              <select id="goal-person">
                <!-- Preenchido via JavaScript -->
              </select>
            </div>
            <div class="form-group">
              <label for="goal-purpose">Propósito</label>
              <textarea id="goal-purpose" placeholder="Descreva o propósito desta meta"></textarea>
            </div>
            <div class="form-group">
              <label for="goal-icon">Ícone</label>
              <div class="icon-selector">
                <div class="selected-icon" id="goal-selected-icon">
                  <i class="fas fa-bullseye"></i>
                </div>
                <div class="icon-grid" id="goal-icon-grid">
                  <div class="icon-item" data-icon="fa-bullseye"><i class="fas fa-bullseye"></i></div>
                  <div class="icon-item" data-icon="fa-home"><i class="fas fa-home"></i></div>
                  <div class="icon-item" data-icon="fa-car"><i class="fas fa-car"></i></div>
                  <div class="icon-item" data-icon="fa-plane"><i class="fas fa-plane"></i></div>
                  <div class="icon-item" data-icon="fa-graduation-cap"><i class="fas fa-graduation-cap"></i></div>
                  <div class="icon-item" data-icon="fa-laptop"><i class="fas fa-laptop"></i></div>
                  <div class="icon-item" data-icon="fa-gift"><i class="fas fa-gift"></i></div>
                  <div class="icon-item" data-icon="fa-heartbeat"><i class="fas fa-heartbeat"></i></div>
                  <div class="icon-item" data-icon="fa-piggy-bank"><i class="fas fa-piggy-bank"></i></div>
                  <div class="icon-item" data-icon="fa-baby"><i class="fas fa-baby"></i></div>
                </div>
                <input type="hidden" id="goal-icon" value="fa-bullseye">
              </div>
            </div>
            <div class="form-group">
              <label for="goal-color">Cor</label>
              <input type="color" id="goal-color" value="#FF9F0A">
            </div>
            <div class="form-actions">
              <button type="button" class="btn btn-secondary close-modal">Cancelar</button>
              <button type="submit" class="btn btn-primary">Salvar</button>
            </div>
          </form>
        </div>
      </div>
    </div>
<!-- ===== FIM: BLOCO 8 ================================ -->

<!-- ===== INÍCIO: BLOCO 9 ============================== -->
    <div id="contribution-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="contribution-modal-title">Novo Aporte</h3>
          <button class="close-modal">&times;</button>
        </div>
        <div class="modal-body">
          <form id="contribution-form">
            <input type="hidden" id="contribution-goal-id">
            <div class="form-group">
              <label for="contribution-amount">Valor (R$)</label>
              <input type="number" id="contribution-amount" placeholder="0,00" step="0.01">
            </div>
            <div class="form-group">
              <label for="contribution-date">Data</label>
              <input type="date" id="contribution-date">
            </div>
            <div class="form-group">
              <label for="contribution-notes">Observações</label>
              <textarea id="contribution-notes" placeholder="Observações opcionais"></textarea>
            </div>
            <div class="form-actions">
              <button type="button" class="btn btn-secondary close-modal">Cancelar</button>
              <button type="submit" class="btn btn-primary">Salvar</button>
            </div>
          </form>
        </div>
      </div>
    </div>
<!-- ===== FIM: BLOCO 9 ================================ -->

<!-- ===== INÍCIO: BLOCO 10 ============================== -->
    <div id="modal-overlay" class="modal-overlay"></div>
    
    <div id="toast" class="toast">
      <div class="toast-content">
        <i id="toast-icon" class="fas fa-check-circle"></i>
        <div class="toast-message" id="toast-message"></div>
      </div>
      <div class="toast-progress"></div>
    </div>

    <div id="confirm-dialog" class="dialog">
      <div class="dialog-content">
        <div class="dialog-header">
          <h3 id="confirm-title">Confirmação</h3>
        </div>
        <div class="dialog-body">
          <p id="confirm-message">Tem certeza que deseja continuar?</p>
        </div>
        <div class="dialog-actions">
          <button id="cancel-btn" class="btn btn-secondary">Cancelar</button>
          <button id="confirm-btn" class="btn btn-danger">Confirmar</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.10.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.10.0/firebase-firestore-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
<!-- ===== FIM: BLOCO 10 ================================ -->

<!-- ===== INÍCIO: BLOCO 11 ============================== -->
  <script>
    // Configuração Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyDvL_nYWhy_8rPouejiWbDZtDCKHYOQyEY",
      authDomain: "calculadora-da-familia.firebaseapp.com",
      projectId: "calculadora-da-familia",
      storageBucket: "calculadora-da-familia.appspot.com",
      messagingSenderId: "69721783786",
      appId: "1:69721783786:web:c4703b5c182e3681e8c693",
      measurementId: "G-YM5TR661S6"
    };

    // Inicialização do Firebase
    let app, db;
    if (!firebase.apps.length) {
      app = firebase.initializeApp(firebaseConfig);
    } else {
      app = firebase.app();
    }
    db = firebase.firestore();
    console.log("Firebase inicializado com sucesso!");

    // Definição das coleções principais
    const transactionsCollection = db ? db.collection('transactions') : null;
    const categoriesCollection = db ? db.collection('categories') : null;
    const personsCollection = db ? db.collection('persons') : null;
    const cardsCollection = db ? db.collection('cards') : null;
    const goalsCollection = db ? db.collection('goals') : null;
    const contributionsCollection = db ? db.collection('contributions') : null;
  </script>
<!-- ===== FIM: BLOCO 11 ================================ -->

<!-- ===== INÍCIO: BLOCO 12 ============================== -->
  <script>
    // Funções Utilitárias
    const utils = {
      // Formatação de moeda
      formatCurrency: (value) => {
        return new Intl.NumberFormat('pt-BR', { 
          style: 'currency', 
          currency: 'BRL' 
        }).format(value);
      },
      
      // Formatação de data para exibição
      formatDate: (date) => {
        if (!date) return '';
        
        if (typeof date === 'string') {
          date = new Date(date);
        }
        
        if (date instanceof firebase.firestore.Timestamp) {
          date = date.toDate();
        }
        
        return date.toLocaleDateString('pt-BR');
      },
      
      // Formatação de data para input
      formatDateForInput: (date) => {
        if (!date) return '';
        
        if (typeof date === 'string' && date.includes('/')) {
          const parts = date.split('/');
          return `${parts[2]}-${parts[1].padStart(2, '0')}-${parts[0].padStart(2, '0')}`;
        }
        
        if (date instanceof firebase.firestore.Timestamp) {
          date = date.toDate();
        }
        
        if (date instanceof Date) {
          const year = date.getFullYear();
          const month = (date.getMonth() + 1).toString().padStart(2, '0');
          const day = date.getDate().toString().padStart(2, '0');
          return `${year}-${month}-${day}`;
        }
        
        return date;
      },
      
      // Obter data atual formatada para input
      getCurrentDateForInput: () => {
        const now = new Date();
        const year = now.getFullYear();
        const month = (now.getMonth() + 1).toString().padStart(2, '0');
        const day = now.getDate().toString().padStart(2, '0');
        return `${year}-${month}-${day}`;
      },
      
      // Obter o mês e ano atual formatado
      getCurrentMonthYear: () => {
        const now = new Date();
        return `${now.getFullYear()}-${(now.getMonth() + 1).toString().padStart(2, '0')}`;
      },
      
      // Obter o primeiro dia do mês
      getFirstDayOfMonth: (year, month) => {
        return new Date(year, month - 1, 1);
      },
      
      // Obter o último dia do mês
      getLastDayOfMonth: (year, month) => {
        return new Date(year, month, 0);
      },
      
      // Verificar se uma data está no mês/ano especificado
      isInMonth: (date, yearMonth) => {
        if (!date || !yearMonth) return false;
        
        if (date instanceof firebase.firestore.Timestamp) {
          date = date.toDate();
        }
        
        if (typeof date === 'string') {
          date = new Date(date);
        }
        
        const [year, month] = yearMonth.split('-');
        return date.getFullYear() === parseInt(year) && date.getMonth() === parseInt(month) - 1;
      },
      
      // Gerar meses para filtro
      generateMonthOptions: () => {
        const options = [];
        const now = new Date();
        const currentYear = now.getFullYear();
        const currentMonth = now.getMonth();
        
        // Gerar opções para 12 meses no passado e 12 meses no futuro
        for (let i = -12; i <= 12; i++) {
          let year = currentYear;
          let month = currentMonth + i;
          
          if (month < 0) {
            const monthsToSubtract = Math.abs(month);
            year -= Math.ceil(monthsToSubtract / 12);
            month = 12 - (monthsToSubtract % 12);
            if (month === 12) {
              month = 0;
              year += 1;
            }
          } else if (month > 11) {
            year += Math.floor(month / 12);
            month = month % 12;
          }
          
          const monthNames = [
            'Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho',
            'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'
          ];
          
          const value = `${year}-${(month + 1).toString().padStart(2, '0')}`;
          const label = `${monthNames[month]} ${year}`;
          
          options.push({ value, label });
        }
        
        // Ordenar do mais recente para o mais antigo
        options.sort((a, b) => b.value.localeCompare(a.value));
        
        return options;
      },
      
      // Calcular saldo final
      calculateBalance: (transactions) => {
        if (!transactions || !transactions.length) return 0;
        
        return transactions.reduce((total, transaction) => {
          const amount = parseFloat(transaction.amount) || 0;
          return total + (transaction.type === 'income' ? amount : -amount);
        }, 0);
      },
      
      // Calcular total de receitas
      calculateTotalIncome: (transactions) => {
        if (!transactions || !transactions.length) return 0;
        
        return transactions.reduce((total, transaction) => {
          if (transaction.type !== 'income') return total;
          return total + (parseFloat(transaction.amount) || 0);
        }, 0);
      },
      
      // Calcular total de despesas
      calculateTotalExpense: (transactions) => {
        if (!transactions || !transactions.length) return 0;
        
        return transactions.reduce((total, transaction) => {
          if (transaction.type !== 'expense') return total;
          return total + (parseFloat(transaction.amount) || 0);
        }, 0);
      },
      
      // Calcular total por categoria
      calculateTotalByCategory: (transactions) => {
        if (!transactions || !transactions.length) return {};
        
        const totals = {};
        
        transactions.forEach(transaction => {
          if (transaction.type !== 'expense') return;
          
          const categoryId = transaction.categoryId;
          const amount = parseFloat(transaction.amount) || 0;
          
          if (!totals[categoryId]) {
            totals[categoryId] = 0;
          }
          
          totals[categoryId] += amount;
        });
        
        return totals;
      },
      
      // Mostrar um toast de notificação
      showToast: (message, type = 'success') => {
        const toast = document.getElementById('toast');
        const toastMessage = document.getElementById('toast-message');
        const toastIcon = document.getElementById('toast-icon');
        const toastProgress = document.querySelector('.toast-progress');
        
        toastMessage.textContent = message;
        
        // Configurar ícone com base no tipo
        switch (type) {
          case 'success':
            toastIcon.className = 'fas fa-check-circle';
            toast.style.borderLeft = '4px solid var(--color-success)';
            toastIcon.style.color = 'var(--color-success)';
            break;
          case 'error':
            toastIcon.className = 'fas fa-times-circle';
            toast.style.borderLeft = '4px solid var(--color-danger)';
            toastIcon.style.color = 'var(--color-danger)';
            break;
          case 'warning':
            toastIcon.className = 'fas fa-exclamation-circle';
            toast.style.borderLeft = '4px solid var(--color-warning)';
            toastIcon.style.color = 'var(--color-warning)';
            break;
          case 'info':
            toastIcon.className = 'fas fa-info-circle';
            toast.style.borderLeft = '4px solid var(--color-info)';
            toastIcon.style.color = 'var(--color-info)';
            break;
        }
        
        // Reset animation
        toastProgress.style.animation = 'none';
        void toastProgress.offsetWidth; // Trigger reflow
        toastProgress.style.animation = 'toast-progress 3s linear forwards';
        
        // Show toast
        toast.classList.add('show');
        
        // Hide toast after 3 seconds
        setTimeout(() => {
          toast.classList.remove('show');
        }, 3000);
      },
      
      // Exibir uma caixa de diálogo de confirmação
      showConfirmDialog: (title, message, onConfirm) => {
        const dialog = document.getElementById('confirm-dialog');
        const confirmTitle = document.getElementById('confirm-title');
        const confirmMessage = document.getElementById('confirm-message');
        const confirmButton = document.getElementById('confirm-btn');
        const cancelButton = document.getElementById('cancel-btn');
        const overlay = document.getElementById('modal-overlay');
        
        confirmTitle.textContent = title;
        confirmMessage.textContent = message;
        
        overlay.classList.add('active');
        dialog.classList.add('active');
        
        const handleConfirm = () => {
          dialog.classList.remove('active');
          overlay.classList.remove('active');
          onConfirm();
          cleanupEventListeners();
        };
        
        const handleCancel = () => {
          dialog.classList.remove('active');
          overlay.classList.remove('active');
          cleanupEventListeners();
        };
        
        const cleanupEventListeners = () => {
          confirmButton.removeEventListener('click', handleConfirm);
          cancelButton.removeEventListener('click', handleCancel);
        };
        
        confirmButton.addEventListener('click', handleConfirm);
        cancelButton.addEventListener('click', handleCancel);
      },
      
      // Verificar se há risco de saldo negativo
      hasNegativeBalanceRisk: (transactions, projectedTransactions) => {
        const currentBalance = utils.calculateBalance(transactions);
        let runningBalance = currentBalance;
        
        for (const transaction of projectedTransactions) {
          const amount = parseFloat(transaction.amount) || 0;
          runningBalance += transaction.type === 'income' ? amount : -amount;
          
          if (runningBalance < 0) {
            return true;
          }
        }
        
        return false;
      },
      
      // Projetar saldo futuro por mês
      projectBalanceByMonth: (transactions, projectedTransactions) => {
        const currentBalance = utils.calculateBalance(transactions);
        const projection = [];
        let runningBalance = currentBalance;
        
        // Agrupar transações projetadas por mês
        const groupedByMonth = {};
        
        projectedTransactions.forEach(transaction => {
          const date = new Date(transaction.date);
          const monthYear = `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}`;
          
          if (!groupedByMonth[monthYear]) {
            groupedByMonth[monthYear] = [];
          }
          
          groupedByMonth[monthYear].push(transaction);
        });
        
        // Ordenar meses
        const sortedMonths = Object.keys(groupedByMonth).sort();
        
        // Calcular saldo para cada mês
        sortedMonths.forEach(month => {
          const monthTransactions = groupedByMonth[month];
          let monthlyIncome = 0;
          let monthlyExpense = 0;
          
          monthTransactions.forEach(transaction => {
            const amount = parseFloat(transaction.amount) || 0;
            if (transaction.type === 'income') {
              monthlyIncome += amount;
            } else {
              monthlyExpense += amount;
            }
          });
          
          const monthlyBalance = monthlyIncome - monthlyExpense;
          runningBalance += monthlyBalance;
          
          const [year, monthNum] = month.split('-');
          const monthNames = [
            'Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho',
            'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'
          ];
          
          projection.push({
            month: monthNames[parseInt(monthNum) - 1],
            year: year,
            income: monthlyIncome,
            expense: monthlyExpense,
            balance: monthlyBalance,
            runningBalance: runningBalance
          });
        });
        
        return projection;
      },
      
      // Calcular progresso de meta
      calculateGoalProgress: (goal, contributions) => {
        if (!goal || !contributions) return 0;
        
        const totalContributed = contributions.reduce((total, contribution) => {
          return total + (parseFloat(contribution.amount) || 0);
        }, 0);
        
        const targetAmount = parseFloat(goal.target) || 0;
        if (targetAmount === 0) return 100; // Evitar divisão por zero
        
        return Math.min(100, (totalContributed / targetAmount) * 100);
      },
      
      // Calcular valor restante para meta
      calculateRemainingAmount: (goal, contributions) => {
        if (!goal || !contributions) return 0;
        
        const totalContributed = contributions.reduce((total, contribution) => {
          return total + (parseFloat(contribution.amount) || 0);
        }, 0);
        
        const targetAmount = parseFloat(goal.target) || 0;
        return Math.max(0, targetAmount - totalContributed);
      },
      
      // Calcular aporte mensal necessário para meta
      calculateRequiredMonthlyContribution: (goal, contributions) => {
        if (!goal || !goal.deadline || !contributions) return 0;
        
        const remainingAmount = utils.calculateRemainingAmount(goal, contributions);
        if (remainingAmount <= 0) return 0;
        
        const today = new Date();
        const deadline = new Date(goal.deadline);
        
        // Se o prazo já passou, retorna o valor restante
        if (deadline <= today) return remainingAmount;
        
        // Calcular meses restantes
        const months = (deadline.getFullYear() - today.getFullYear()) * 12 + 
                       (deadline.getMonth() - today.getMonth());
        
        if (months <= 0) return remainingAmount;
        
        return remainingAmount / months;
      }
    };
  </script>
<!-- ===== FIM: BLOCO 12 ================================ -->

<!-- ===== INÍCIO: BLOCO 13 ============================== -->
  <script>
    // Serviço Firebase - Funções de acesso ao banco de dados
    const firebaseService = {
      // Transações
      transactions: {
        // Obter todas as transações
        getAll: async () => {
          try {
            const snapshot = await transactionsCollection.get();
            return snapshot.docs.map(doc => ({
              id: doc.id,
              ...doc.data()
            }));
          } catch (error) {
            console.error("Erro ao obter transações:", error);
            utils.showToast("Erro ao carregar transações", "error");
            return [];
          }
        },
        
        // Obter transações por mês
        getByMonth: async (yearMonth) => {
          try {
            const [year, month] = yearMonth.split('-');
            const firstDay = utils.getFirstDayOfMonth(parseInt(year), parseInt(month));
            const lastDay = utils.getLastDayOfMonth(parseInt(year), parseInt(month));
            
            const snapshot = await transactionsCollection
              .where('date', '>=', firstDay)
              .where('date', '<=', lastDay)
              .get();
            
            return snapshot.docs.map(doc => ({
              id: doc.id,
              ...doc.data()
            }));
          } catch (error) {
            console.error("Erro ao obter transações por mês:", error);
            utils.showToast("Erro ao carregar transações do mês", "error");
            return [];
          }
        },
        
        // Adicionar uma transação
        add: async (transaction) => {
          try {
            // Converter string de data para objeto Date
            if (transaction.date && typeof transaction.date === 'string') {
              transaction.date = new Date(transaction.date);
            }
            
            // Adicionar timestamp de criação
            transaction.createdAt = firebase.firestore.FieldValue.serverTimestamp();
            
            // Adicionar a transação ao Firestore
            const docRef = await transactionsCollection.add(transaction);
            
            // Se for uma transação recorrente, criar transações futuras
            if (transaction.isRecurrent && transaction.recurrentFrequency) {
              await firebaseService.transactions.createRecurrentTransactions(
                { id: docRef.id, ...transaction }
              );
            }
            
            // Se for um parcelamento, criar transações para parcelas futuras
            if (transaction.paymentMethod === 'credit' && 
                transaction.installments && 
                transaction.installments > 1) {
              await firebaseService.transactions.createInstallments(
                { id: docRef.id, ...transaction }
              );
            }
            
            utils.showToast("Transação adicionada com sucesso", "success");
            return { id: docRef.id, ...transaction };
          } catch (error) {
            console.error("Erro ao adicionar transação:", error);
            utils.showToast("Erro ao adicionar transação", "error");
            throw error;
          }
        },
        
        // Atualizar uma transação
        update: async (id, transaction) => {
          try {
            // Converter string de data para objeto Date
            if (transaction.date && typeof transaction.date === 'string') {
              transaction.date = new Date(transaction.date);
            }
            
            // Adicionar timestamp de atualização
            transaction.updatedAt = firebase.firestore.FieldValue.serverTimestamp();
            
            // Atualizar a transação no Firestore
            await transactionsCollection.doc(id).update(transaction);
            
            utils.showToast("Transação atualizada com sucesso", "success");
            return { id, ...transaction };
          } catch (error) {
            console.error("Erro ao atualizar transação:", error);
            utils.showToast("Erro ao atualizar transação", "error");
            throw error;
          }
        },
        
        // Remover uma transação
        remove: async (id) => {
          try {
            await transactionsCollection.doc(id).delete();
            utils.showToast("Transação removida com sucesso", "success");
            return true;
          } catch (error) {
            console.error("Erro ao remover transação:", error);
            utils.showToast("Erro ao remover transação", "error");
            throw error;
          }
        },
        
        // Criar transações recorrentes
        createRecurrentTransactions: async (baseTransaction) => {
          try {
            const frequency = baseTransaction.recurrentFrequency;
            const recurrenceCount = {
              'monthly': 6,      // 6 meses
              'bimonthly': 3,    // 3 bimestres (6 meses)
              'quarterly': 2,    // 2 trimestres (6 meses)
              'semiannual': 1,   // 1 semestre
              'annual': 1        // 1 ano
            }[frequency] || 0;
            
            const intervalMonths = {
              'monthly': 1,
              'bimonthly': 2,
              'quarterly': 3,
              'semiannual': 6,
              'annual': 12
            }[frequency] || 0;
            
            if (recurrenceCount === 0) return;
            
            const baseDate = new Date(baseTransaction.date);
            const recurrentTransactions = [];
            
            // Remover propriedades que não queremos copiar
            const { id, createdAt, updatedAt, ...transactionData } = baseTransaction;
            
            // Criar transações futuras
            for (let i = 1; i <= recurrenceCount; i++) {
              const newDate = new Date(baseDate);
              newDate.setMonth(baseDate.getMonth() + (i * intervalMonths));
              
              const recurrentTransaction = {
                ...transactionData,
                date: newDate,
                recurrentGroupId: id,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
              };
              
              const docRef = await transactionsCollection.add(recurrentTransaction);
              recurrentTransactions.push({ id: docRef.id, ...recurrentTransaction });
            }
            
            return recurrentTransactions;
          } catch (error) {
            console.error("Erro ao criar transações recorrentes:", error);
            utils.showToast("Erro ao criar transações recorrentes", "error");
            throw error;
          }
        },
        
        // Criar transações para parcelas de cartão de crédito
        createInstallments: async (baseTransaction) => {
          try {
            const installmentCount = parseInt(baseTransaction.installments) || 1;
            if (installmentCount <= 1) return;
            
            const baseDate = new Date(baseTransaction.date);
            const installmentAmount = parseFloat(baseTransaction.amount) / installmentCount;
            const installmentTransactions = [];
            
            // Remover propriedades que não queremos copiar
            const { id, createdAt, updatedAt, ...transactionData } = baseTransaction;
            
            // Criar transações para parcelas futuras (a primeira parcela é a própria transação base)
            for (let i = 1; i < installmentCount; i++) {
              const newDate = new Date(baseDate);
              newDate.setMonth(baseDate.getMonth() + i);
              
              const installmentTransaction = {
                ...transactionData,
                date: newDate,
                amount: installmentAmount.toFixed(2),
                description: `${transactionData.description} (${i+1}/${installmentCount})`,
                installmentGroupId: id,
                installmentNumber: i + 1,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
              };
              
              const docRef = await transactionsCollection.add(installmentTransaction);
              installmentTransactions.push({ id: docRef.id, ...installmentTransaction });
            }
            
            // Atualizar a transação base para indicar que é a primeira parcela
            await transactionsCollection.doc(id).update({
              amount: installmentAmount.toFixed(2),
              description: `${transactionData.description} (1/${installmentCount})`,
              installmentNumber: 1
            });
            
            return installmentTransactions;
          } catch (error) {
            console.error("Erro ao criar parcelas:", error);
            utils.showToast("Erro ao criar parcelas", "error");
            throw error;
          }
        }
      },
      
      // Categorias
      categories: {
        // Obter todas as categorias
        getAll: async () => {
          try {
            const snapshot = await categoriesCollection.get();
            return snapshot.docs.map(doc => ({
              id: doc.id,
              ...doc.data()
            }));
          } catch (error) {
            console.error("Erro ao obter categorias:", error);
            utils.showToast("Erro ao carregar categorias", "error");
            return [];
          }
        },
        
        // Adicionar uma categoria
        add: async (category) => {
          try {
            // Adicionar timestamp de criação
            category.createdAt = firebase.firestore.FieldValue.serverTimestamp();
            
            const docRef = await categoriesCollection.add(category);
            utils.showToast("Categoria adicionada com sucesso", "success");
            return { id: docRef.id, ...category };
          } catch (error) {
            console.error("Erro ao adicionar categoria:", error);
            utils.showToast("Erro ao adicionar categoria", "error");
            throw error;
          }
        },
        
        // Atualizar uma categoria
        update: async (id, category) => {
          try {
            // Adicionar timestamp de atualização
            category.updatedAt = firebase.firestore.FieldValue.serverTimestamp();
            
            await categoriesCollection.doc(id).update(category);
            utils.showToast("Categoria atualizada com sucesso", "success");
            return { id, ...category };
          } catch (error) {
            console.error("Erro ao atualizar categoria:", error);
            utils.showToast("Erro ao atualizar categoria", "error");
            throw error;
          }
        },
        
        // Remover uma categoria
        remove: async (id) => {
          try {
            // Verificar se há transações usando esta categoria
            const transactionsSnapshot = await transactionsCollection
              .where('categoryId', '==', id)
              .limit(1)
              .get();
            
            if (!transactionsSnapshot.empty) {
              utils.showToast("Não é possível excluir categoria em uso", "error");
              return false;
            }
            
            await categoriesCollection.doc(id).delete();
            utils.showToast("Categoria removida com sucesso", "success");
            return true;
          } catch (error) {
            console.error("Erro ao remover categoria:", error);
            utils.showToast("Erro ao remover categoria", "error");
            throw error;
          }
        },
        
        // Criar categorias iniciais se não existirem
        createInitialCategories: async () => {
          try {
            const snapshot = await categoriesCollection.get();
            if (!snapshot.empty) return; // Já existem categorias
            
            const initialCategories = [
              {
                name: 'Alimentação',
                icon: 'fa-utensils',
                color: '#FF9F0A'
              },
              {
                name: 'Moradia',
                icon: 'fa-home',
                color: '#5E5CE6'
              },
              {
                name: 'Transporte',
                icon: 'fa-car',
                color: '#FF453A'
              },
              {
                name: 'Saúde',
                icon: 'fa-heartbeat',
                color: '#30D158'
              },
              {
                name: 'Educação',
                icon: 'fa-graduation-cap',
                color: '#0A84FF'
              },
              {
                name: 'Lazer',
                icon: 'fa-gamepad',
                color: '#BF5AF2'
              },
              {
                name: 'Despesas Pessoais',
                icon: 'fa-user',
                color: '#64D2FF'
              },
              {
                name: 'Salário',
                icon: 'fa-money-bill-wave',
                color: '#30D158'
              }
            ];
            
            for (const category of initialCategories) {
              category.createdAt = firebase.firestore.FieldValue.serverTimestamp();
              await categoriesCollection.add(category);
            }
            
            console.log("Categorias iniciais criadas com sucesso");
          } catch (error) {
            console.error("Erro ao criar categorias iniciais:", error);
          }
        }
      },
      
      // Pessoas
      persons: {
        // Obter todas as pessoas
        getAll: async () => {
          try {
            const snapshot = await personsCollection.get();
            return snapshot.docs.map(doc => ({
              id: doc.id,
              ...doc.data()
            }));
          } catch (error) {
            console.error("Erro ao obter pessoas:", error);
            utils.showToast("Erro ao carregar pessoas", "error");
            return [];
          }
        },
        
        // Adicionar uma pessoa
        add: async (person) => {
          try {
            // Adicionar timestamp de criação
            person.createdAt = firebase.firestore.FieldValue.serverTimestamp();
            
            const docRef = await personsCollection.add(person);
            utils.showToast("Pessoa adicionada com sucesso", "success");
            return { id: docRef.id, ...person };
          } catch (error) {
            console.error("Erro ao adicionar pessoa:", error);
            utils.showToast("Erro ao adicionar pessoa", "error");
            throw error;
          }
        },
        
        // Atualizar uma pessoa
        update: async (id, person) => {
          try {
            // Adicionar timestamp de atualização
            person.updatedAt = firebase.firestore.FieldValue.serverTimestamp();
            
            await personsCollection.doc(id).update(person);
            utils.showToast("Pessoa atualizada com sucesso", "success");
            return { id, ...person };
          } catch (error) {
            console.error("Erro ao atualizar pessoa:", error);
            utils.showToast("Erro ao atualizar pessoa", "error");
            throw error;
          }
        },
        
        // Remover uma pessoa
        remove: async (id) => {
          try {
            // Verificar se há transações usando esta pessoa
            const transactionsSnapshot = await transactionsCollection
              .where('personId', '==', id)
              .limit(1)
              .get();
            
            if (!transactionsSnapshot.empty) {
              utils.showToast("Não é possível excluir pessoa em uso", "error");
              return false;
            }
            
            await personsCollection.doc(id).delete();
            utils.showToast("Pessoa removida com sucesso", "success");
            return true;
          } catch (error) {
            console.error("Erro ao remover pessoa:", error);
            utils.showToast("Erro ao remover pessoa", "error");
            throw error;
          }
        },
        
        // Criar pessoa inicial se não existir
        createInitialPerson: async () => {
          try {
            const snapshot = await personsCollection.get();
            if (!snapshot.empty) return; // Já existem pessoas
            
            const initialPerson = {
              name: 'Família',
              avatar: 'avatar-1',
              createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            await personsCollection.add(initialPerson);
            console.log("Pessoa inicial criada com sucesso");
          } catch (error) {
            console.error("Erro ao criar pessoa inicial:", error);
          }
        }
      },
<!-- ===== FIM: BLOCO 13 ================================ -->

<!-- ===== INÍCIO: BLOCO 14 ============================== -->
      // Cartões de crédito
      cards: {
        // Obter todos os cartões
        getAll: async () => {
          try {
            const snapshot = await cardsCollection.get();
            return snapshot.docs.map(doc => ({
              id: doc.id,
              ...doc.data()
            }));
          } catch (error) {
            console.error("Erro ao obter cartões:", error);
            utils.showToast("Erro ao carregar cartões", "error");
            return [];
          }
        },
        
        // Adicionar um cartão
        add: async (card) => {
          try {
            // Adicionar timestamp de criação
            card.createdAt = firebase.firestore.FieldValue.serverTimestamp();
            
            const docRef = await cardsCollection.add(card);
            utils.showToast("Cartão adicionado com sucesso", "success");
            return { id: docRef.id, ...card };
          } catch (error) {
            console.error("Erro ao adicionar cartão:", error);
            utils.showToast("Erro ao adicionar cartão", "error");
            throw error;
          }
        },
        
        // Atualizar um cartão
        update: async (id, card) => {
          try {
            // Adicionar timestamp de atualização
            card.updatedAt = firebase.firestore.FieldValue.serverTimestamp();
            
            await cardsCollection.doc(id).update(card);
            utils.showToast("Cartão atualizado com sucesso", "success");
            return { id, ...card };
          } catch (error) {
            console.error("Erro ao atualizar cartão:", error);
            utils.showToast("Erro ao atualizar cartão", "error");
            throw error;
          }
        },
        
        // Remover um cartão
        remove: async (id) => {
          try {
            // Verificar se há transações usando este cartão
            const transactionsSnapshot = await transactionsCollection
              .where('cardId', '==', id)
              .limit(1)
              .get();
            
            if (!transactionsSnapshot.empty) {
              utils.showToast("Não é possível excluir cartão em uso", "error");
              return false;
            }
            
            await cardsCollection.doc(id).delete();
            utils.showToast("Cartão removido com sucesso", "success");
            return true;
          } catch (error) {
            console.error("Erro ao remover cartão:", error);
            utils.showToast("Erro ao remover cartão", "error");
            throw error;
          }
        }
      },
      
      // Metas financeiras
      goals: {
        // Obter todas as metas
        getAll: async () => {
          try {
            const snapshot = await goalsCollection.get();
            return snapshot.docs.map(doc => ({
              id: doc.id,
              ...doc.data()
            }));
          } catch (error) {
            console.error("Erro ao obter metas:", error);
            utils.showToast("Erro ao carregar metas", "error");
            return [];
          }
        },
        
        // Adicionar uma meta
        add: async (goal) => {
          try {
            // Converter string de data para objeto Date
            if (goal.deadline && typeof goal.deadline === 'string') {
              goal.deadline = new Date(goal.deadline);
            }
            
            // Adicionar timestamp de criação
            goal.createdAt = firebase.firestore.FieldValue.serverTimestamp();
            
            const docRef = await goalsCollection.add(goal);
            utils.showToast("Meta adicionada com sucesso", "success");
            return { id: docRef.id, ...goal };
          } catch (error) {
            console.error("Erro ao adicionar meta:", error);
            utils.showToast("Erro ao adicionar meta", "error");
            throw error;
          }
        },
        
        // Atualizar uma meta
        update: async (id, goal) => {
          try {
            // Converter string de data para objeto Date
            if (goal.deadline && typeof goal.deadline === 'string') {
              goal.deadline = new Date(goal.deadline);
            }
            
            // Adicionar timestamp de atualização
            goal.updatedAt = firebase.firestore.FieldValue.serverTimestamp();
            
            await goalsCollection.doc(id).update(goal);
            utils.showToast("Meta atualizada com sucesso", "success");
            return { id, ...goal };
          } catch (error) {
            console.error("Erro ao atualizar meta:", error);
            utils.showToast("Erro ao atualizar meta", "error");
            throw error;
          }
        },
        
        // Remover uma meta
        remove: async (id) => {
          try {
            // Verificar se há contribuições para esta meta
            const contributionsSnapshot = await contributionsCollection
              .where('goalId', '==', id)
              .get();
            
            // Remover todas as contribuições vinculadas a esta meta
            const batch = db.batch();
            contributionsSnapshot.docs.forEach(doc => {
              batch.delete(doc.ref);
            });
            
            // Remover a meta
            batch.delete(goalsCollection.doc(id));
            
            // Executar o batch
            await batch.commit();
            
            utils.showToast("Meta removida com sucesso", "success");
            return true;
          } catch (error) {
            console.error("Erro ao remover meta:", error);
            utils.showToast("Erro ao remover meta", "error");
            throw error;
          }
        }
      },
      
      // Aportes em metas
      contributions: {
        // Obter todos os aportes
        getAll: async () => {
          try {
            const snapshot = await contributionsCollection.get();
            return snapshot.docs.map(doc => ({
              id: doc.id,
              ...doc.data()
            }));
          } catch (error) {
            console.error("Erro ao obter aportes:", error);
            utils.showToast("Erro ao carregar aportes", "error");
            return [];
          }
        },
        
        // Obter aportes por meta
        getByGoal: async (goalId) => {
          try {
            const snapshot = await contributionsCollection
              .where('goalId', '==', goalId)
              .orderBy('date', 'desc')
              .get();
            
            return snapshot.docs.map(doc => ({
              id: doc.id,
              ...doc.data()
            }));
          } catch (error) {
            console.error("Erro ao obter aportes por meta:", error);
            utils.showToast("Erro ao carregar aportes da meta", "error");
            return [];
          }
        },
        
        // Adicionar um aporte
        add: async (contribution) => {
          try {
            // Converter string de data para objeto Date
            if (contribution.date && typeof contribution.date === 'string') {
              contribution.date = new Date(contribution.date);
            }
            
            // Adicionar timestamp de criação
            contribution.createdAt = firebase.firestore.FieldValue.serverTimestamp();
            
            const docRef = await contributionsCollection.add(contribution);
            utils.showToast("Aporte adicionado com sucesso", "success");
            return { id: docRef.id, ...contribution };
          } catch (error) {
            console.error("Erro ao adicionar aporte:", error);
            utils.showToast("Erro ao adicionar aporte", "error");
            throw error;
          }
        },
        
        // Atualizar um aporte
        update: async (id, contribution) => {
          try {
            // Converter string de data para objeto Date
            if (contribution.date && typeof contribution.date === 'string') {
              contribution.date = new Date(contribution.date);
            }
            
            // Adicionar timestamp de atualização
            contribution.updatedAt = firebase.firestore.FieldValue.serverTimestamp();
            
            await contributionsCollection.doc(id).update(contribution);
            utils.showToast("Aporte atualizado com sucesso", "success");
            return { id, ...contribution };
          } catch (error) {
            console.error("Erro ao atualizar aporte:", error);
            utils.showToast("Erro ao atualizar aporte", "error");
            throw error;
          }
        },
        
        // Remover um aporte
        remove: async (id) => {
          try {
            await contributionsCollection.doc(id).delete();
            utils.showToast("Aporte removido com sucesso", "success");
            return true;
          } catch (error) {
            console.error("Erro ao remover aporte:", error);
            utils.showToast("Erro ao remover aporte", "error");
            throw error;
          }
        }
      }
    };
  </script>
<!-- ===== FIM: BLOCO 14 ================================ -->

<!-- ===== INÍCIO: BLOCO 15 ============================== -->
  <script>
    // Componentes de UI - Funções para manipulação da interface
    const uiComponents = {
      // Inicializar os componentes da UI
      init: () => {
        uiComponents.setupModuleNavigation();
        uiComponents.setupThemeToggle();
        uiComponents.setupModalHandlers();
        uiComponents.setupFilterHandlers();
      },
      
      // Configurar navegação entre módulos
      setupModuleNavigation: () => {
        const navItems = document.querySelectorAll('.nav-item');
        const contentArea = document.querySelector('.content-area');
        const currentModuleTitle = document.getElementById('current-module-title');
        
        navItems.forEach(item => {
          item.addEventListener('click', () => {
            // Atualizar item ativo no menu
            navItems.forEach(i => i.classList.remove('active'));
            item.classList.add('active');
            
            // Obter o módulo a ser exibido
            const moduleId = item.getAttribute('data-module');
            currentModuleTitle.textContent = item.querySelector('span').textContent;
            
            // Carregar o módulo adequado
            contentArea.innerHTML = '<div class="loading-spinner"><i class="fas fa-spinner fa-spin"></i></div>';
            
            // Fechar sidebar em dispositivos móveis
            if (window.innerWidth <= 768) {
              document.querySelector('.sidebar').classList.remove('open');
            }
            
            // Renderizar o módulo selecionado
            setTimeout(() => {
              switch (moduleId) {
                case 'dashboard':
                  dashboardModule.render();
                  break;
                case 'monthly-analysis':
                  monthlyAnalysisModule.render();
                  break;
                case 'cash-projection':
                  cashProjectionModule.render();
                  break;
                case 'financial-goals':
                  financialGoalsModule.render();
                  break;
                case 'settings':
                  settingsModule.render();
                  break;
                default:
                  contentArea.innerHTML = '<p>Módulo não encontrado</p>';
              }
            }, 300);
          });
        });
        
        // Configurar botão de toggle da sidebar em dispositivos móveis
        const toggleSidebarBtn = document.getElementById('toggle-sidebar');
        const sidebar = document.querySelector('.sidebar');
        
        toggleSidebarBtn.addEventListener('click', () => {
          sidebar.classList.toggle('open');
        });
      },
      
      // Configurar alteração de tema (claro/escuro)
      setupThemeToggle: () => {
        const themeToggleBtn = document.getElementById('theme-toggle');
        const themeIcon = themeToggleBtn.querySelector('i');
        
        // Verificar preferência de tema salva
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme) {
          document.body.setAttribute('data-theme', savedTheme);
          themeIcon.className = savedTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
        }
        
        // Evento para alternar o tema
        themeToggleBtn.addEventListener('click', () => {
          const currentTheme = document.body.getAttribute('data-theme');
          const newTheme = currentTheme === 'light' ? 'dark' : 'light';
          
          document.body.setAttribute('data-theme', newTheme);
          themeIcon.className = newTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
          
          // Salvar preferência de tema
          localStorage.setItem('theme', newTheme);
        });
      },
      
      // Configurar manipuladores para modais
      setupModalHandlers: () => {
        const modals = document.querySelectorAll('.modal');
        const modalOverlay = document.getElementById('modal-overlay');
        const closeModalButtons = document.querySelectorAll('.close-modal');
        const newTransactionBtn = document.getElementById('new-transaction-btn');
        const transactionModal = document.getElementById('transaction-modal');
        
        // Função para abrir um modal
        const openModal = (modal) => {
          modalOverlay.classList.add('active');
          modal.classList.add('active');
        };
        
        // Função para fechar todos os modais
        const closeAllModals = () => {
          modalOverlay.classList.remove('active');
          modals.forEach(modal => modal.classList.remove('active'));
        };
        
        // Configurar evento para botão de nova transação
        newTransactionBtn.addEventListener('click', () => {
          // Limpar formulário
          document.getElementById('transaction-form').reset();
          document.getElementById('transaction-id').value = '';
          document.getElementById('transaction-date').value = utils.getCurrentDateForInput();
          document.getElementById('modal-title').textContent = 'Nova Transação';
          
          // Mostrar modal
          openModal(transactionModal);
          
          // Focar no primeiro campo
          document.getElementById('transaction-description').focus();
        });
        
        // Configurar fechamento de modais
        closeModalButtons.forEach(button => {
          button.addEventListener('click', closeAllModals);
        });
        
        // Clicar fora do modal também fecha
        modalOverlay.addEventListener('click', (event) => {
          if (event.target === modalOverlay) {
            closeAllModals();
          }
        });
        
        // Tecla ESC para fechar modais
        document.addEventListener('keydown', (event) => {
          if (event.key === 'Escape') {
            closeAllModals();
          }
        });
        
        // Configurar detalhes de cartão de crédito
        const paymentMethodSelect = document.getElementById('transaction-payment-method');
        const creditCardDetails = document.getElementById('credit-card-details');
        
        paymentMethodSelect.addEventListener('change', () => {
          creditCardDetails.style.display = 
            paymentMethodSelect.value === 'credit' ? 'flex' : 'none';
        });
        
        // Configurar detalhes de recorrência
        const recurrentCheckbox = document.getElementById('transaction-recurrent');
        const recurrentDetails = document.getElementById('recurrent-details');
        
        recurrentCheckbox.addEventListener('change', () => {
          recurrentDetails.style.display = 
            recurrentCheckbox.checked ? 'block' : 'none';
        });
        
        // Configurar formulário de transação
        const transactionForm = document.getElementById('transaction-form');
        
        transactionForm.addEventListener('submit', async (event) => {
          event.preventDefault();
          
          // Obter valores do formulário
          const transactionId = document.getElementById('transaction-id').value;
          const description = document.getElementById('transaction-description').value.trim();
          const amount = document.getElementById('transaction-amount').value;
          const date = document.getElementById('transaction-date').value;
          const type = document.getElementById('transaction-type').value;
          const categoryId = document.getElementById('transaction-category').value;
          const paymentMethod = document.getElementById('transaction-payment-method').value;
          const personId = document.getElementById('transaction-person').value;
          const priority = document.getElementById('transaction-priority').value;
          const notes = document.getElementById('transaction-notes').value.trim();
          const isRecurrent = document.getElementById('transaction-recurrent').checked;
          
          // Validação básica
          if (!description) {
            utils.showToast("Descrição é obrigatória", "error");
            return;
          }
          
          if (!amount || parseFloat(amount) <= 0) {
            utils.showToast("Valor deve ser maior que zero", "error");
            return;
          }
          
          if (!date) {
            utils.showToast("Data é obrigatória", "error");
            return;
          }
          
          // Preparar objeto de transação
          const transaction = {
            description,
            amount,
            date,
            type,
            categoryId,
            paymentMethod,
            personId,
            priority,
            notes,
            isRecurrent
          };
          
          // Adicionar detalhes específicos para cartão de crédito
          if (paymentMethod === 'credit') {
            transaction.cardId = document.getElementById('transaction-card').value;
            transaction.installments = document.getElementById('transaction-installments').value;
          }
          
          // Adicionar detalhes de recorrência
          if (isRecurrent) {
            transaction.recurrentFrequency = document.getElementById('recurrent-frequency').value;
          }
          
          try {
            // Adicionar ou atualizar transação
            if (transactionId) {
              await firebaseService.transactions.update(transactionId, transaction);
            } else {
              await firebaseService.transactions.add(transaction);
            }
            
            // Fechar modal e atualizar a visualização atual
            closeAllModals();
            
            // Recarregar o módulo ativo
            const activeModule = document.querySelector('.nav-item.active').getAttribute('data-module');
            switch (activeModule) {
              case 'dashboard':
                dashboardModule.render();
                break;
              case 'monthly-analysis':
                monthlyAnalysisModule.render();
                break;
              case 'cash-projection':
                cashProjectionModule.render();
                break;
              default:
                // Outros módulos não precisam ser atualizados após uma nova transação
                break;
            }
          } catch (error) {
            console.error("Erro ao salvar transação:", error);
          }
        });
      },
      
      // Configurar manipuladores para filtros
      setupFilterHandlers: () => {
        const monthFilter = document.getElementById('month-filter');
        const paymentFilter = document.getElementById('payment-filter');
        const personFilter = document.getElementById('person-filter');
        
        // Preencher opções de mês
        const monthOptions = utils.generateMonthOptions();
        monthOptions.forEach(option => {
          const optionElement = document.createElement('option');
          optionElement.value = option.value;
          optionElement.textContent = option.label;
          monthFilter.appendChild(optionElement);
        });
        
        // Definir mês atual como padrão
        monthFilter.value = utils.getCurrentMonthYear();
        
        // Evento para atualizar visualização quando filtros mudam
        const updateViewOnFilterChange = () => {
          const activeModule = document.querySelector('.nav-item.active').getAttribute('data-module');
          switch (activeModule) {
            case 'dashboard':
              dashboardModule.render();
              break;
            case 'monthly-analysis':
              monthlyAnalysisModule.render();
              break;
            default:
              // Outros módulos podem não usar estes filtros
              break;
          }
        };
        
        monthFilter.addEventListener('change', updateViewOnFilterChange);
        paymentFilter.addEventListener('change', updateViewOnFilterChange);
        personFilter.addEventListener('change', updateViewOnFilterChange);
        
        // Preencher opções de pessoa (será atualizado quando os dados forem carregados)
        const loadPersonOptions = async () => {
          const persons = await firebaseService.persons.getAll();
          
          // Limpar opções existentes (exceto a primeira - "Todas as pessoas")
          while (personFilter.options.length > 1) {
            personFilter.remove(1);
          }
          
          // Adicionar pessoas como opções
          persons.forEach(person => {
            const option = document.createElement('option');
            option.value = person.id;
            option.textContent = person.name;
            personFilter.appendChild(option);
          });
        };
        
        // Carregar opções iniciais
        loadPersonOptions();
      },
      
      // Carregar opções de categoria no formulário
      loadCategoryOptions: async (selectElement) => {
        try {
          const categories = await firebaseService.categories.getAll();
          
          // Limpar opções existentes
          selectElement.innerHTML = '';
          
          // Opção padrão
          const defaultOption = document.createElement('option');
          defaultOption.value = '';
          defaultOption.textContent = 'Selecione uma categoria';
          selectElement.appendChild(defaultOption);
          
          // Adicionar categorias como opções
          categories.forEach(category => {
            const option = document.createElement('option');
            option.value = category.id;
            option.textContent = category.name;
            selectElement.appendChild(option);
          });
        } catch (error) {
          console.error("Erro ao carregar categorias:", error);
        }
      },
      
      // Carregar opções de pessoa no formulário
      loadPersonOptions: async (selectElement) => {
        try {
          const persons = await firebaseService.persons.getAll();
          
          // Limpar opções existentes
          selectElement.innerHTML = '';
          
          // Opção padrão
          const defaultOption = document.createElement('option');
          defaultOption.value = '';
          defaultOption.textContent = 'Selecione uma pessoa';
          selectElement.appendChild(defaultOption);
          
          // Adicionar pessoas como opções
          persons.forEach(person => {
            const option = document.createElement('option');
            option.value = person.id;
            option.textContent = person.name;
            selectElement.appendChild(option);
          });
        } catch (error) {
          console.error("Erro ao carregar pessoas:", error);
        }
      },
      
      // Carregar opções de cartão no formulário
      loadCardOptions: async (selectElement) => {
        try {
          const cards = await firebaseService.cards.getAll();
          
          // Limpar opções existentes
          selectElement.innerHTML = '';
          
          // Opção padrão
          const defaultOption = document.createElement('option');
          defaultOption.value = '';
          defaultOption.textContent = 'Selecione um cartão';
          selectElement.appendChild(defaultOption);
          
          // Adicionar cartões como opções
          cards.forEach(card => {
            const option = document.createElement('option');
            option.value = card.id;
            option.textContent = card.name;
            selectElement.appendChild(option);
          });
        } catch (error) {
          console.error("Erro ao carregar cartões:", error);
        }
      },
      
      // Criar um card de KPI
      createKpiCard: (title, value, icon, type = '') => {
        const card = document.createElement('div');
        card.className = 'kpi-card';
        
        const titleElement = document.createElement('div');
        titleElement.className = 'kpi-title';
        titleElement.textContent = title;
        
        const valueElement = document.createElement('div');
        valueElement.className = 'kpi-value';
        valueElement.textContent = value;
        
        const detailsElement = document.createElement('div');
        detailsElement.className = 'kpi-details';
        
        if (icon) {
          const iconElement = document.createElement('i');
          iconElement.className = icon;
          
          if (type === 'positive') {
            iconElement.classList.add('kpi-positive');
          } else if (type === 'negative') {
            iconElement.classList.add('kpi-negative');
          }
          
          detailsElement.appendChild(iconElement);
        }
        
        card.appendChild(titleElement);
        card.appendChild(valueElement);
        card.appendChild(detailsElement);
        
        return card;
      },
      
      // Criar uma tabela de transações
      createTransactionsTable: (transactions, categories, persons, cards) => {
        const table = document.createElement('table');
        
        // Cabeçalho da tabela
        const thead = document.createElement('thead');
        const headerRow = document.createElement('tr');
        
        ['Descrição', 'Valor', 'Data', 'Categoria', 'Pessoa', 'Ações'].forEach(text => {
          const th = document.createElement('th');
          th.textContent = text;
          headerRow.appendChild(th);
        });
        
        thead.appendChild(headerRow);
        table.appendChild(thead);
        
        // Corpo da tabela
        const tbody = document.createElement('tbody');
        
        if (transactions.length === 0) {
          const emptyRow = document.createElement('tr');
          const emptyCell = document.createElement('td');
          emptyCell.colSpan = 6;
          emptyCell.textContent = 'Nenhuma transação encontrada';
          emptyCell.style.textAlign = 'center';
          emptyRow.appendChild(emptyCell);
          tbody.appendChild(emptyRow);
        } else {
          // Criar mapa de categorias e pessoas para acesso rápido
          const categoriesMap = {};
          categories.forEach(category => {
            categoriesMap[category.id] = category;
          });
          
          const personsMap = {};
          persons.forEach(person => {
            personsMap[person.id] = person;
          });
          
          const cardsMap = {};
          cards.forEach(card => {
            cardsMap[card.id] = card;
          });
          
          // Adicionar linhas para cada transação
          transactions.forEach(transaction => {
            const row = document.createElement('tr');
            
            // Descrição
            const descCell = document.createElement('td');
            descCell.textContent = transaction.description;
            row.appendChild(descCell);
            
            // Valor
            const amountCell = document.createElement('td');
            const amount = parseFloat(transaction.amount);
            amountCell.textContent = utils.formatCurrency(amount);
            amountCell.className = transaction.type === 'income' ? 'income-amount' : 'expense-amount';
            row.appendChild(amountCell);
            
            // Data
            const dateCell = document.createElement('td');
            dateCell.textContent = utils.formatDate(transaction.date);
            row.appendChild(dateCell);
            
            // Categoria
            const categoryCell = document.createElement('td');
            const category = categoriesMap[transaction.categoryId];
            if (category) {
              const categoryIcon = document.createElement('i');
              categoryIcon.className = `fas ${category.icon}`;
              categoryIcon.style.color = category.color;
              categoryIcon.style.marginRight = '8px';
              categoryCell.appendChild(categoryIcon);
              
              const categoryName = document.createTextNode(category.name);
              categoryCell.appendChild(categoryName);
            } else {
              categoryCell.textContent = 'Sem categoria';
            }
            row.appendChild(categoryCell);
            
            // Pessoa
            const personCell = document.createElement('td');
            const person = personsMap[transaction.personId];
            personCell.textContent = person ? person.name : 'Sem pessoa';
            row.appendChild(personCell);
            
            // Ações
            const actionsCell = document.createElement('td');
            actionsCell.className = 'table-action-buttons';
            
            // Botão de edição
            const editBtn = document.createElement('button');
            editBtn.className = 'table-action-btn';
            editBtn.innerHTML = '<i class="fas fa-edit"></i>';
            editBtn.title = 'Editar';
            editBtn.addEventListener('click', () => {
              uiComponents.editTransaction(transaction, categories, persons, cards);
            });
            actionsCell.appendChild(editBtn);
            
            // Botão de exclusão
            const deleteBtn = document.createElement('button');
            deleteBtn.className = 'table-action-btn';
            deleteBtn.innerHTML = '<i class="fas fa-trash-alt"></i>';
            deleteBtn.title = 'Excluir';
            deleteBtn.addEventListener('click', () => {
              utils.showConfirmDialog(
                'Confirmar Exclusão', 
                'Tem certeza que deseja excluir esta transação?',
                async () => {
                  await firebaseService.transactions.remove(transaction.id);
                  
                  // Recarregar transações
                  const activeModule = document.querySelector('.nav-item.active').getAttribute('data-module');
                  switch (activeModule) {
                    case 'dashboard':
                      dashboardModule.render();
                      break;
                    case 'monthly-analysis':
                      monthlyAnalysisModule.render();
                      break;
                    default:
                      break;
                  }
                }
              );
            });
            actionsCell.appendChild(deleteBtn);
            
            row.appendChild(actionsCell);
            tbody.appendChild(row);
          });
        }
        
        table.appendChild(tbody);
        
        return table;
      },
      
      // Função para editar uma transação existente
      editTransaction: (transaction, categories, persons, cards) => {
        // Preencher formulário com os dados da transação
        document.getElementById('transaction-id').value = transaction.id;
        document.getElementById('transaction-description').value = transaction.description;
        document.getElementById('transaction-amount').value = transaction.amount;
        document.getElementById('transaction-date').value = utils.formatDateForInput(transaction.date);
        document.getElementById('transaction-type').value = transaction.type;
        document.getElementById('transaction-category').value = transaction.categoryId;
        document.getElementById('transaction-payment-method').value = transaction.paymentMethod;
        document.getElementById('transaction-person').value = transaction.personId;
        document.getElementById('transaction-priority').value = transaction.priority || 'medium';
        document.getElementById('transaction-notes').value = transaction.notes || '';
        
        // Configurar recorrência
        const recurrentCheckbox = document.getElementById('transaction-recurrent');
        recurrentCheckbox.checked = transaction.isRecurrent || false;
        
        const recurrentDetails = document.getElementById('recurrent-details');
        recurrentDetails.style.display = recurrentCheckbox.checked ? 'block' : 'none';
        
        if (recurrentCheckbox.checked) {
          document.getElementById('recurrent-frequency').value = transaction.recurrentFrequency || 'monthly';
        }
        
        // Configurar detalhes de cartão de crédito
        const creditCardDetails = document.getElementById('credit-card-details');
        creditCardDetails.style.display = transaction.paymentMethod === 'credit' ? 'flex' : 'none';
        
        if (transaction.paymentMethod === 'credit') {
          document.getElementById('transaction-card').value = transaction.cardId || '';
          document.getElementById('transaction-installments').value = transaction.installments || '1';
        }
        
        // Atualizar título do modal
        document.getElementById('modal-title').textContent = 'Editar Transação';
        
        // Abrir modal
        const transactionModal = document.getElementById('transaction-modal');
        const modalOverlay = document.getElementById('modal-overlay');
        
        modalOverlay.classList.add('active');
        transactionModal.classList.add('active');
      }
    };
  </script>
<!-- ===== FIM: BLOCO 15 ================================ -->

<!-- ===== INÍCIO: BLOCO 16 ============================== -->
  <script>
    // Módulo Dashboard - Página inicial com visão geral
    const dashboardModule = {
      // Renderizar o módulo na área de conteúdo
      render: async () => {
        try {
          const contentArea = document.querySelector('.content-area');
          contentArea.innerHTML = '<div class="loading-spinner"><i class="fas fa-spinner fa-spin"></i></div>';
          
          // Obter o mês selecionado no filtro
          const monthFilter = document.getElementById('month-filter');
          const selectedMonth = monthFilter.value;
          
          // Obter o método de pagamento selecionado no filtro
          const paymentFilter = document.getElementById('payment-filter');
          const selectedPayment = paymentFilter.value;
          
          // Obter a pessoa selecionada no filtro
          const personFilter = document.getElementById('person-filter');
          const selectedPerson = personFilter.value;
          
          // Carregar dados necessários
          const [transactions, categories, persons, cards] = await Promise.all([
            firebaseService.transactions.getAll(),
            firebaseService.categories.getAll(),
            firebaseService.persons.getAll(),
            firebaseService.cards.getAll()
          ]);
          
          // Filtrar transações pelo mês selecionado
          let filteredTransactions = transactions.filter(transaction => 
            utils.isInMonth(transaction.date, selectedMonth)
          );
          
          // Filtrar pelo método de pagamento, se selecionado
          if (selectedPayment !== 'all') {
            filteredTransactions = filteredTransactions.filter(transaction => 
              transaction.paymentMethod === selectedPayment
            );
          }
          
          // Filtrar pela pessoa, se selecionada
          if (selectedPerson !== 'all') {
            filteredTransactions = filteredTransactions.filter(transaction => 
              transaction.personId === selectedPerson
            );
          }
          
          // Separar receitas e despesas
          const incomes = filteredTransactions.filter(transaction => transaction.type === 'income');
          const expenses = filteredTransactions.filter(transaction => transaction.type === 'expense');
          
          // Calcular totais
          const totalIncome = utils.calculateTotalIncome(filteredTransactions);
          const totalExpense = utils.calculateTotalExpense(filteredTransactions);
          const balance = totalIncome - totalExpense;
          
          // Calcular totais por categoria
          const expensesByCategory = utils.calculateTotalByCategory(filteredTransactions);
          
          // Filtrar despesas fixas (prioridade essential)
          const fixedExpenses = expenses.filter(transaction => transaction.priority === 'essential');
          const fixedExpensesTotal = utils.calculateTotalExpense(fixedExpenses);
          const fixedExpensesPercentage = totalExpense > 0 ? (fixedExpensesTotal / totalExpense) * 100 : 0;
          
          // Filtrar despesas variáveis (outras prioridades)
          const variableExpenses = expenses.filter(transaction => transaction.priority !== 'essential');
          const variableExpensesTotal = utils.calculateTotalExpense(variableExpenses);
          const variableExpensesPercentage = totalExpense > 0 ? (variableExpensesTotal / totalExpense) * 100 : 0;
          
          // Obter saldo atual disponível (todas as transações até hoje)
          const currentDate = new Date();
          const allTransactionsUntilToday = transactions.filter(transaction => {
            const transactionDate = new Date(transaction.date);
            return transactionDate <= currentDate;
          });
          const availableBalance = utils.calculateBalance(allTransactionsUntilToday);
          
          // Calcular gastos previstos em cartões de crédito
          const futureCardExpenses = transactions.filter(transaction => {
            const transactionDate = new Date(transaction.date);
            return (
              transaction.type === 'expense' && 
              transaction.paymentMethod === 'credit' && 
              transactionDate > currentDate
            );
          });
          const totalFutureCardExpenses = utils.calculateTotalExpense(futureCardExpenses);
          
          // Preparar dados para gráficos
          const categoryData = [];
          const categoryColors = [];
          
          categories.forEach(category => {
            const total = expensesByCategory[category.id] || 0;
            if (total > 0) {
              categoryData.push({
                name: category.name,
                value: total
              });
              categoryColors.push(category.color);
            }
          });
          
          // Construir HTML do dashboard
          const dashboard = document.createElement('div');
          
          // Seção de KPIs
          const kpisSection = document.createElement('section');
          kpisSection.className = 'dashboard-section';
          
          const kpisTitle = document.createElement('h3');
          kpisTitle.textContent = 'Resumo Financeiro';
          kpisSection.appendChild(kpisTitle);
          
          const kpisGrid = document.createElement('div');
          kpisGrid.className = 'dashboard-grid';
          
          // KPI - Saldo Disponível
          kpisGrid.appendChild(uiComponents.createKpiCard(
            'Saldo Disponível',
            utils.formatCurrency(availableBalance),
            availableBalance >= 0 ? 'fas fa-arrow-up' : 'fas fa-arrow-down',
            availableBalance >= 0 ? 'positive' : 'negative'
          ));
          
          // KPI - Receita no Mês
          kpisGrid.appendChild(uiComponents.createKpiCard(
            'Receita no Mês',
            utils.formatCurrency(totalIncome),
            'fas fa-plus',
            'positive'
          ));
          
          // KPI - Despesa no Mês
          kpisGrid.appendChild(uiComponents.createKpiCard(
            'Despesa no Mês',
            utils.formatCurrency(totalExpense),
            'fas fa-minus',
            'negative'
          ));
          
          // KPI - Saldo do Mês
          kpisGrid.appendChild(uiComponents.createKpiCard(
            'Saldo do Mês',
            utils.formatCurrency(balance),
            balance >= 0 ? 'fas fa-arrow-up' : 'fas fa-arrow-down',
            balance >= 0 ? 'positive' : 'negative'
          ));
          
          // KPI - Despesas Fixas
          kpisGrid.appendChild(uiComponents.createKpiCard(
            'Despesas Fixas',
            `${utils.formatCurrency(fixedExpensesTotal)} (${fixedExpensesPercentage.toFixed(1)}%)`,
            'fas fa-thumbtack'
          ));
          
          // KPI - Despesas Variáveis
          kpisGrid.appendChild(uiComponents.createKpiCard(
            'Despesas Variáveis',
            `${utils.formatCurrency(variableExpensesTotal)} (${variableExpensesPercentage.toFixed(1)}%)`,
            'fas fa-random'
          ));
          
          // KPI - Gastos Provisionados em Cartão
          kpisGrid.appendChild(uiComponents.createKpiCard(
            'Provisionado em Cartões',
            utils.formatCurrency(totalFutureCardExpenses),
            'fas fa-credit-card'
          ));
          
          kpisSection.appendChild(kpisGrid);
          dashboard.appendChild(kpisSection);
          
          // Seção de Gráficos
          const chartsSection = document.createElement('section');
          chartsSection.className = 'dashboard-section';
          
          const chartsTitle = document.createElement('h3');
          chartsTitle.textContent = 'Análise de Gastos';
          chartsSection.appendChild(chartsTitle);
          
          const chartsGrid = document.createElement('div');
          chartsGrid.className = 'charts-grid';
          
          // Gráfico de Despesas por Categoria
          const categoryChartContainer = document.createElement('div');
          categoryChartContainer.className = 'chart-container';
          
          const categoryCanvas = document.createElement('canvas');
          categoryCanvas.id = 'category-chart';
          categoryChartContainer.appendChild(categoryCanvas);
          
          // Gráfico de Fixas x Variáveis
          const fixedVsVariableChartContainer = document.createElement('div');
          fixedVsVariableChartContainer.className = 'chart-container';
          
          const fixedVsVariableCanvas = document.createElement('canvas');
          fixedVsVariableCanvas.id = 'fixed-vs-variable-chart';
          fixedVsVariableChartContainer.appendChild(fixedVsVariableCanvas);
          
          chartsGrid.appendChild(categoryChartContainer);
          chartsGrid.appendChild(fixedVsVariableChartContainer);
          chartsSection.appendChild(chartsGrid);
          dashboard.appendChild(chartsSection);
          
          // Seção de Transações Recentes
          const transactionsSection = document.createElement('section');
          transactionsSection.className = 'dashboard-section';
          
          const transactionsTitle = document.createElement('h3');
          transactionsTitle.textContent = 'Transações Recentes';
          transactionsSection.appendChild(transactionsTitle);
          
          // Ordenar transações pela data (mais recentes primeiro)
          const sortedTransactions = [...filteredTransactions].sort((a, b) => {
            const dateA = new Date(a.date);
            const dateB = new Date(b.date);
            return dateB - dateA;
          });
          
          // Limitar a 10 transações mais recentes
          const recentTransactions = sortedTransactions.slice(0, 10);
          
          const tableContainer = document.createElement('div');
          tableContainer.className = 'table-container';
          tableContainer.appendChild(uiComponents.createTransactionsTable(
            recentTransactions, categories, persons, cards
          ));
          
          transactionsSection.appendChild(tableContainer);
          dashboard.appendChild(transactionsSection);
          
          // Renderizar dashboard
          contentArea.innerHTML = '';
          contentArea.appendChild(dashboard);
          
          // Inicializar gráficos
          if (categoryData.length > 0) {
            new Chart(document.getElementById('category-chart'), {
              type: 'doughnut',
              data: {
                labels: categoryData.map(item => item.name),
                datasets: [{
                  data: categoryData.map(item => item.value),
                  backgroundColor: categoryColors,
                  borderWidth: 1
                }]
              },
              options: {
                responsive: true,
                plugins: {
                  legend: {
                    position: 'right',
                  },
                  title: {
                    display: true,
                    text: 'Despesas por Categoria'
                  }
                }
              }
            });
          } else {
            document.getElementById('category-chart').parentNode.innerHTML = 
              '<div class="empty-chart-message">Sem dados para exibir</div>';
          }
          
          // Gráfico de Fixas x Variáveis
          if (fixedExpensesTotal > 0 || variableExpensesTotal > 0) {
            new Chart(document.getElementById('fixed-vs-variable-chart'), {
              type: 'pie',
              data: {
                labels: ['Despesas Fixas', 'Despesas Variáveis'],
                datasets: [{
                  data: [fixedExpensesTotal, variableExpensesTotal],
                  backgroundColor: ['#5E5CE6', '#FF9F0A'],
                  borderWidth: 1
                }]
              },
              options: {
                responsive: true,
                plugins: {
                  legend: {
                    position: 'right',
                  },
                  title: {
                    display: true,
                    text: 'Fixas x Variáveis'
                  }
                }
              }
            });
          } else {
            document.getElementById('fixed-vs-variable-chart').parentNode.innerHTML = 
              '<div class="empty-chart-message">Sem dados para exibir</div>';
          }
          
          // Verificar se há alertas a serem exibidos
          dashboardModule.checkAlerts(transactions, cards);
          
        } catch (error) {
          console.error("Erro ao renderizar dashboard:", error);
          const contentArea = document.querySelector('.content-area');
          contentArea.innerHTML = '<div class="error-message">Erro ao carregar dashboard</div>';
        }
      },
      
      // Verificar se há alertas a serem exibidos
      checkAlerts: (transactions, cards) => {
        const currentDate = new Date();
        const alerts = [];
        
        // Verificar vencimentos de faturas próximos (próximos 3 dias)
        cards.forEach(card => {
          const dueDay = parseInt(card.dueDay);
          if (!dueDay) return;
          
          const dueDate = new Date(currentDate);
          dueDate.setDate(dueDay);
          
          // Se o dia de vencimento já passou neste mês, calcular para o próximo mês
          if (dueDate < currentDate) {
            dueDate.setMonth(dueDate.getMonth() + 1);
          }
          
          const diffDays = Math.floor((dueDate - currentDate) / (1000 * 60 * 60 * 24));
          
          if (diffDays <= 3) {
            alerts.push({
              type: 'warning',
              message: `Fatura do cartão ${card.name} vence em ${diffDays} dias`
            });
          }
        });
        
        // Verificar risco de saldo negativo
        const allTransactionsUntilToday = transactions.filter(transaction => {
          const transactionDate = new Date(transaction.date);
          return transactionDate <= currentDate;
        });
        
        const futureTransactions = transactions.filter(transaction => {
          const transactionDate = new Date(transaction.date);
          return transactionDate > currentDate;
        });
        
        if (utils.hasNegativeBalanceRisk(allTransactionsUntilToday, futureTransactions)) {
          alerts.push({
            type: 'danger',
            message: 'Risco de saldo negativo detectado nos próximos meses'
          });
        }
        
        // Exibir alertas se houver
        if (alerts.length > 0) {
          const alertsContainer = document.createElement('div');
          alertsContainer.className = 'alerts-container';
          
          alerts.forEach(alert => {
            const alertElement = document.createElement('div');
            alertElement.className = `alert alert-${alert.type}`;
            
            const alertIcon = document.createElement('i');
            alertIcon.className = alert.type === 'danger' ? 
              'fas fa-exclamation-triangle' : 'fas fa-exclamation-circle';
            alertElement.appendChild(alertIcon);
            
            const alertText = document.createTextNode(` ${alert.message}`);
            alertElement.appendChild(alertText);
            
            alertsContainer.appendChild(alertElement);
          });
          
          // Inserir alertas no início do dashboard
          const dashboard = document.querySelector('.content-area > div');
          dashboard.insertBefore(alertsContainer, dashboard.firstChild);
        }
      }
    };
  </script>
<!-- ===== FIM: BLOCO 16 ================================ -->

<!-- ===== INÍCIO: BLOCO 17 ============================== -->
  <script>
    // Módulo de Análise Mensal - Visualização detalhada por mês
    const monthlyAnalysisModule = {
      // Renderizar o módulo na área de conteúdo
      render: async () => {
        try {
          const contentArea = document.querySelector('.content-area');
          contentArea.innerHTML = '<div class="loading-spinner"><i class="fas fa-spinner fa-spin"></i></div>';
          
          // Obter o mês selecionado no filtro
          const monthFilter = document.getElementById('month-filter');
          const selectedMonth = monthFilter.value;
          
          // Obter o método de pagamento selecionado no filtro
          const paymentFilter = document.getElementById('payment-filter');
          const selectedPayment = paymentFilter.value;
          
          // Obter a pessoa selecionada no filtro
          const personFilter = document.getElementById('person-filter');
          const selectedPerson = personFilter.value;
          
          // Carregar dados necessários
          const [transactions, categories, persons, cards] = await Promise.all([
            firebaseService.transactions.getAll(),
            firebaseService.categories.getAll(),
            firebaseService.persons.getAll(),
            firebaseService.cards.getAll()
          ]);
          
          // Filtrar transações pelo mês selecionado
          let filteredTransactions = transactions.filter(transaction => 
            utils.isInMonth(transaction.date, selectedMonth)
          );
          
          // Filtrar pelo método de pagamento, se selecionado
          if (selectedPayment !== 'all') {
            filteredTransactions = filteredTransactions.filter(transaction => 
              transaction.paymentMethod === selectedPayment
            );
          }
          
          // Filtrar pela pessoa, se selecionada
          if (selectedPerson !== 'all') {
            filteredTransactions = filteredTransactions.filter(transaction => 
              transaction.personId === selectedPerson
            );
          }
          
          // Separar receitas e despesas
          const incomes = filteredTransactions.filter(transaction => transaction.type === 'income');
          const expenses = filteredTransactions.filter(transaction => transaction.type === 'expense');
          
          // Calcular totais
          const totalIncome = utils.calculateTotalIncome(filteredTransactions);
          const totalExpense = utils.calculateTotalExpense(filteredTransactions);
          const balance = totalIncome - totalExpense;
          
          // Construir HTML da análise mensal
          const monthlyAnalysis = document.createElement('div');
          
          // Adicionar filtros adicionais específicos para este módulo
          const filtersSection = document.createElement('section');
          filtersSection.className = 'filters-section';
          
          const filtersForm = document.createElement('form');
          filtersForm.className = 'filters-form';
          filtersForm.id = 'monthly-analysis-filters';
          
          // Filtro por categoria
          const categoryFilterGroup = document.createElement('div');
          categoryFilterGroup.className = 'filter-group';
          
          const categoryFilterLabel = document.createElement('label');
          categoryFilterLabel.htmlFor = 'category-filter';
          categoryFilterLabel.textContent = 'Categoria:';
          categoryFilterGroup.appendChild(categoryFilterLabel);
          
          const categoryFilter = document.createElement('select');
          categoryFilter.id = 'category-filter';
          categoryFilter.className = 'filter-select';
          
          // Opção padrão - todas categorias
          const allCategoriesOption = document.createElement('option');
          allCategoriesOption.value = 'all';
          allCategoriesOption.textContent = 'Todas as categorias';
          categoryFilter.appendChild(allCategoriesOption);
          
          // Adicionar categorias ao filtro
          categories.forEach(category => {
            const option = document.createElement('option');
            option.value = category.id;
            option.textContent = category.name;
            categoryFilter.appendChild(option);
          });
          
          categoryFilterGroup.appendChild(categoryFilter);
          filtersForm.appendChild(categoryFilterGroup);
          
          // Filtro por prioridade
          const priorityFilterGroup = document.createElement('div');
          priorityFilterGroup.className = 'filter-group';
          
          const priorityFilterLabel = document.createElement('label');
          priorityFilterLabel.htmlFor = 'priority-filter';
          priorityFilterLabel.textContent = 'Prioridade:';
          priorityFilterGroup.appendChild(priorityFilterLabel);
          
          const priorityFilter = document.createElement('select');
          priorityFilter.id = 'priority-filter';
          priorityFilter.className = 'filter-select';
          
          // Opções de prioridade
          ['all', 'essential', 'high', 'medium', 'low'].forEach(priority => {
            const option = document.createElement('option');
            option.value = priority;
            
            switch (priority) {
              case 'all':
                option.textContent = 'Todas as prioridades';
                break;
              case 'essential':
                option.textContent = 'Essencial';
                break;
              case 'high':
                option.textContent = 'Alta';
                break;
              case 'medium':
                option.textContent = 'Média';
                break;
              case 'low':
                option.textContent = 'Baixa';
                break;
            }
            
            priorityFilter.appendChild(option);
          });
          
          priorityFilterGroup.appendChild(priorityFilter);
          filtersForm.appendChild(priorityFilterGroup);
          
          // Filtro por tipo de transação
          const typeFilterGroup = document.createElement('div');
          typeFilterGroup.className = 'filter-group';
          
          const typeFilterLabel = document.createElement('label');
          typeFilterLabel.htmlFor = 'type-filter';
          typeFilterLabel.textContent = 'Tipo:';
          typeFilterGroup.appendChild(typeFilterLabel);
          
          const typeFilter = document.createElement('select');
          typeFilter.id = 'type-filter';
          typeFilter.className = 'filter-select';
          
          // Opções de tipo
          const typeOptions = [
            { value: 'all', text: 'Todos os tipos' },
            { value: 'income', text: 'Receitas' },
            { value: 'expense', text: 'Despesas' }
          ];
          
          typeOptions.forEach(option => {
            const optionElement = document.createElement('option');
            optionElement.value = option.value;
            optionElement.textContent = option.text;
            typeFilter.appendChild(optionElement);
          });
          
          typeFilterGroup.appendChild(typeFilter);
          filtersForm.appendChild(typeFilterGroup);
          
          // Opções de ordenação
          const sortFilterGroup = document.createElement('div');
          sortFilterGroup.className = 'filter-group';
          
          const sortFilterLabel = document.createElement('label');
          sortFilterLabel.htmlFor = 'sort-filter';
          sortFilterLabel.textContent = 'Ordenar por:';
          sortFilterGroup.appendChild(sortFilterLabel);
          
          const sortFilter = document.createElement('select');
          sortFilter.id = 'sort-filter';
          sortFilter.className = 'filter-select';
          
          // Opções de ordenação
          const sortOptions = [
            { value: 'date-desc', text: 'Data (mais recente)' },
            { value: 'date-asc', text: 'Data (mais antiga)' },
            { value: 'amount-desc', text: 'Valor (maior)' },
            { value: 'amount-asc', text: 'Valor (menor)' },
            { value: 'priority', text: 'Prioridade' }
          ];
          
          sortOptions.forEach(option => {
            const optionElement = document.createElement('option');
            optionElement.value = option.value;
            optionElement.textContent = option.text;
            sortFilter.appendChild(optionElement);
          });
          
          sortFilterGroup.appendChild(sortFilter);
          filtersForm.appendChild(sortFilterGroup);
          
          // Adicionar botão de aplicar filtros
          const applyFiltersButton = document.createElement('button');
          applyFiltersButton.type = 'button';
          applyFiltersButton.className = 'btn btn-primary';
          applyFiltersButton.textContent = 'Aplicar Filtros';
          filtersForm.appendChild(applyFiltersButton);
          
          filtersSection.appendChild(filtersForm);
          monthlyAnalysis.appendChild(filtersSection);
          
          // Seção de resumo
          const summarySection = document.createElement('section');
          summarySection.className = 'monthly-summary-section';
          
          const summaryTitle = document.createElement('h3');
          summaryTitle.textContent = 'Resumo do Mês';
          summarySection.appendChild(summaryTitle);
          
          const summaryGrid = document.createElement('div');
          summaryGrid.className = 'summary-grid';
          
          // Resumo - Receitas
          const incomeCard = document.createElement('div');
          incomeCard.className = 'summary-card income-card';
          
          const incomeTitle = document.createElement('div');
          incomeTitle.className = 'summary-title';
          incomeTitle.textContent = 'Receitas';
          incomeCard.appendChild(incomeTitle);
          
          const incomeValue = document.createElement('div');
          incomeValue.className = 'summary-value';
          incomeValue.textContent = utils.formatCurrency(totalIncome);
          incomeCard.appendChild(incomeValue);
          
          summaryGrid.appendChild(incomeCard);
          
          // Resumo - Despesas
          const expenseCard = document.createElement('div');
          expenseCard.className = 'summary-card expense-card';
          
          const expenseTitle = document.createElement('div');
          expenseTitle.className = 'summary-title';
          expenseTitle.textContent = 'Despesas';
          expenseCard.appendChild(expenseTitle);
          
          const expenseValue = document.createElement('div');
          expenseValue.className = 'summary-value';
          expenseValue.textContent = utils.formatCurrency(totalExpense);
          expenseCard.appendChild(expenseValue);
          
          summaryGrid.appendChild(expenseCard);
          
          // Resumo - Saldo
          const balanceCard = document.createElement('div');
          balanceCard.className = `summary-card ${balance >= 0 ? 'positive-card' : 'negative-card'}`;
          
          const balanceTitle = document.createElement('div');
          balanceTitle.className = 'summary-title';
          balanceTitle.textContent = 'Saldo';
          balanceCard.appendChild(balanceTitle);
          
          const balanceValue = document.createElement('div');
          balanceValue.className = 'summary-value';
          balanceValue.textContent = utils.formatCurrency(balance);
          balanceCard.appendChild(balanceValue);
          
          summaryGrid.appendChild(balanceCard);
          
          summarySection.appendChild(summaryGrid);
          monthlyAnalysis.appendChild(summarySection);
          
          // Seção de transações
          const transactionsSection = document.createElement('section');
          transactionsSection.className = 'monthly-transactions-section';
          
          const transactionsTitle = document.createElement('h3');
          transactionsTitle.textContent = 'Transações do Mês';
          transactionsSection.appendChild(transactionsTitle);
          
          // Contenedor para a tabela (será atualizado pelos filtros)
          const tableContainer = document.createElement('div');
          tableContainer.className = 'table-container';
          tableContainer.id = 'transactions-table-container';
          
          // Renderizar tabela inicial
          tableContainer.appendChild(uiComponents.createTransactionsTable(
            filteredTransactions, categories, persons, cards
          ));
          
          transactionsSection.appendChild(tableContainer);
          monthlyAnalysis.appendChild(transactionsSection);
          
          // Renderizar análise mensal
          contentArea.innerHTML = '';
          contentArea.appendChild(monthlyAnalysis);
          
          // Configurar eventos dos filtros adicionais
          applyFiltersButton.addEventListener('click', () => {
            // Obter valores dos filtros adicionais
            const categoryValue = categoryFilter.value;
            const priorityValue = priorityFilter.value;
            const typeValue = typeFilter.value;
            const sortValue = sortFilter.value;
            
            // Aplicar filtros
            let filteredResults = [...filteredTransactions];
            
            // Filtrar por categoria
            if (categoryValue !== 'all') {
              filteredResults = filteredResults.filter(transaction => 
                transaction.categoryId === categoryValue
              );
            }
            
            // Filtrar por prioridade
            if (priorityValue !== 'all') {
              filteredResults = filteredResults.filter(transaction => 
                transaction.priority === priorityValue
              );
            }
            
            // Filtrar por tipo de transação
            if (typeValue !== 'all') {
              filteredResults = filteredResults.filter(transaction => 
                transaction.type === typeValue
              );
            }
            
            // Aplicar ordenação
            filteredResults.sort((a, b) => {
              const dateA = new Date(a.date);
              const dateB = new Date(b.date);
              const amountA = parseFloat(a.amount) || 0;
              const amountB = parseFloat(b.amount) || 0;
              
              // Prioridades em ordem de importância
              const priorityOrder = {
                'essential': 0,
                'high': 1,
                'medium': 2,
                'low': 3
              };
              
              switch (sortValue) {
                case 'date-desc':
                  return dateB - dateA;
                case 'date-asc':
                  return dateA - dateB;
                case 'amount-desc':
                  return amountB - amountA;
                case 'amount-asc':
                  return amountA - amountB;
                case 'priority':
                  const priorityA = priorityOrder[a.priority] || 4;
                  const priorityB = priorityOrder[b.priority] || 4;
                  return priorityA - priorityB;
                default:
                  return dateB - dateA;
              }
            });
            
            // Atualizar tabela com resultados filtrados
            const tableContainer = document.getElementById('transactions-table-container');
            tableContainer.innerHTML = '';
            tableContainer.appendChild(uiComponents.createTransactionsTable(
              filteredResults, categories, persons, cards
            ));
          });
          
        } catch (error) {
          console.error("Erro ao renderizar análise mensal:", error);
          const contentArea = document.querySelector('.content-area');
          contentArea.innerHTML = '<div class="error-message">Erro ao carregar análise mensal</div>';
        }
      }
    };
  </script>
<!-- ===== FIM: BLOCO 17 ================================ -->

<!-- ===== INÍCIO: BLOCO 18 ============================== -->
  <script>
    // Módulo de Projeção de Caixa - Visualização de saldo futuro
    const cashProjectionModule = {
      // Renderizar o módulo na área de conteúdo
      render: async () => {
        try {
          const contentArea = document.querySelector('.content-area');
          contentArea.innerHTML = '<div class="loading-spinner"><i class="fas fa-spinner fa-spin"></i></div>';
          
          // Carregar dados necessários
          const transactions = await firebaseService.transactions.getAll();
          
          // Filtrar transações
          const currentDate = new Date();
          
          // Transações atuais (até hoje)
          const currentTransactions = transactions.filter(transaction => {
            const transactionDate = new Date(transaction.date);
            return transactionDate <= currentDate;
          });
          
          // Transações futuras (após hoje)
          const futureTransactions = transactions.filter(transaction => {
            const transactionDate = new Date(transaction.date);
            return transactionDate > currentDate;
          });
          
          // Calcular saldo atual disponível
          const currentBalance = utils.calculateBalance(currentTransactions);
          
          // Projetar saldo futuro por mês
          const projection = utils.projectBalanceByMonth(currentTransactions, futureTransactions);
          
          // Construir HTML da projeção de caixa
          const cashProjection = document.createElement('div');
          
          // Seção de filtros específicos para este módulo
          const filtersSection = document.createElement('section');
          filtersSection.className = 'filters-section';
          
          const filtersForm = document.createElement('form');
          filtersForm.className = 'filters-form';
          filtersForm.id = 'projection-filters';
          
          // Filtro por período
          const periodFilterGroup = document.createElement('div');
          periodFilterGroup.className = 'filter-group';
          
          const periodFilterLabel = document.createElement('label');
          periodFilterLabel.htmlFor = 'period-filter';
          periodFilterLabel.textContent = 'Período:';
          periodFilterGroup.appendChild(periodFilterLabel);
          
          const periodFilter = document.createElement('select');
          periodFilter.id = 'period-filter';
          periodFilter.className = 'filter-select';
          
          // Opções de período
          const periodOptions = [
            { value: 'monthly', text: 'Mês a mês' },
            { value: 'quarterly', text: 'Trimestres' },
            { value: 'semiannual', text: 'Semestres' },
            { value: 'annual', text: 'Anual' },
            { value: 'custom', text: 'Período personalizado' }
          ];
          
          periodOptions.forEach(option => {
            const optionElement = document.createElement('option');
            optionElement.value = option.value;
            optionElement.textContent = option.text;
            periodFilter.appendChild(optionElement);
          });
          
          periodFilterGroup.appendChild(periodFilter);
          filtersForm.appendChild(periodFilterGroup);
          
          // Grupo de período personalizado (inicialmente oculto)
          const customPeriodGroup = document.createElement('div');
          customPeriodGroup.className = 'filter-group custom-period-group';
          customPeriodGroup.style.display = 'none';
          
          const startDateGroup = document.createElement('div');
          startDateGroup.className = 'date-input-group';
          
          const startDateLabel = document.createElement('label');
          startDateLabel.htmlFor = 'start-date';
          startDateLabel.textContent = 'Data Inicial:';
          startDateGroup.appendChild(startDateLabel);
          
          const startDateInput = document.createElement('input');
          startDateInput.type = 'date';
          startDateInput.id = 'start-date';
          startDateInput.className = 'date-input';
          startDateInput.value = utils.getCurrentDateForInput();
          startDateGroup.appendChild(startDateInput);
          
          customPeriodGroup.appendChild(startDateGroup);
          
          const endDateGroup = document.createElement('div');
          endDateGroup.className = 'date-input-group';
          
          const endDateLabel = document.createElement('label');
          endDateLabel.htmlFor = 'end-date';
          endDateLabel.textContent = 'Data Final:';
          endDateGroup.appendChild(endDateLabel);
          
          const endDateInput = document.createElement('input');
          endDateInput.type = 'date';
          endDateInput.id = 'end-date';
          endDateInput.className = 'date-input';
          
          // Definir data final como 12 meses no futuro
          const endDate = new Date();
          endDate.setFullYear(endDate.getFullYear() + 1);
          endDateInput.value = utils.formatDateForInput(endDate);
          
          endDateGroup.appendChild(endDateInput);
          customPeriodGroup.appendChild(endDateGroup);
          
          filtersForm.appendChild(customPeriodGroup);
          
          // Botão para aplicar filtros
          const applyFiltersButton = document.createElement('button');
          applyFiltersButton.type = 'button';
          applyFiltersButton.className = 'btn btn-primary';
          applyFiltersButton.textContent = 'Aplicar Filtros';
          filtersForm.appendChild(applyFiltersButton);
          
          filtersSection.appendChild(filtersForm);
          cashProjection.appendChild(filtersSection);
          
          // Seção de resumo
          const summarySection = document.createElement('section');
          summarySection.className = 'projection-summary-section';
          
          const summaryTitle = document.createElement('h3');
          summaryTitle.textContent = 'Resumo de Projeção';
          summarySection.appendChild(summaryTitle);
          
          const summaryGrid = document.createElement('div');
          summaryGrid.className = 'summary-grid';
          
          // Resumo - Saldo Atual
          const balanceCard = document.createElement('div');
          balanceCard.className = `summary-card ${currentBalance >= 0 ? 'positive-card' : 'negative-card'}`;
          
          const balanceTitle = document.createElement('div');
          balanceTitle.className = 'summary-title';
          balanceTitle.textContent = 'Saldo Atual';
          balanceCard.appendChild(balanceTitle);
          
          const balanceValue = document.createElement('div');
          balanceValue.className = 'summary-value';
          balanceValue.textContent = utils.formatCurrency(currentBalance);
          balanceCard.appendChild(balanceValue);
          
          summaryGrid.appendChild(balanceCard);
          
          // Resumo - Entradas Futuras
          const futureIncomesTotal = futureTransactions
            .filter(t => t.type === 'income')
            .reduce((total, t) => total + parseFloat(t.amount), 0);
          
          const incomeCard = document.createElement('div');
          incomeCard.className = 'summary-card income-card';
          
          const incomeTitle = document.createElement('div');
          incomeTitle.className = 'summary-title';
          incomeTitle.textContent = 'Entradas Futuras';
          incomeCard.appendChild(incomeTitle);
          
          const incomeValue = document.createElement('div');
          incomeValue.className = 'summary-value';
          incomeValue.textContent = utils.formatCurrency(futureIncomesTotal);
          incomeCard.appendChild(incomeValue);
          
          summaryGrid.appendChild(incomeCard);
          
          // Resumo - Saídas Futuras
          const futureExpensesTotal = futureTransactions
            .filter(t => t.type === 'expense')
            .reduce((total, t) => total + parseFloat(t.amount), 0);
          
          const expenseCard = document.createElement('div');
          expenseCard.className = 'summary-card expense-card';
          
          const expenseTitle = document.createElement('div');
          expenseTitle.className = 'summary-title';
          expenseTitle.textContent = 'Saídas Futuras';
          expenseCard.appendChild(expenseTitle);
          
          const expenseValue = document.createElement('div');
          expenseValue.className = 'summary-value';
          expenseValue.textContent = utils.formatCurrency(futureExpensesTotal);
          expenseCard.appendChild(expenseValue);
          
          summaryGrid.appendChild(expenseCard);
          
          // Resumo - Saldo Projetado Final
          const projectedFinalBalance = currentBalance + futureIncomesTotal - futureExpensesTotal;
          
          const projectedCard = document.createElement('div');
          projectedCard.className = `summary-card ${projectedFinalBalance >= 0 ? 'positive-card' : 'negative-card'}`;
          
          const projectedTitle = document.createElement('div');
          projectedTitle.className = 'summary-title';
          projectedTitle.textContent = 'Saldo Projetado Final';
          projectedCard.appendChild(projectedTitle);
          
          const projectedValue = document.createElement('div');
          projectedValue.className = 'summary-value';
          projectedValue.textContent = utils.formatCurrency(projectedFinalBalance);
          projectedCard.appendChild(projectedValue);
          
          summaryGrid.appendChild(projectedCard);
          
          summarySection.appendChild(summaryGrid);
          cashProjection.appendChild(summarySection);
          
          // Seção do gráfico de projeção
          const chartSection = document.createElement('section');
          chartSection.className = 'projection-chart-section';
          
          const chartTitle = document.createElement('h3');
          chartTitle.textContent = 'Evolução do Saldo Projetado';
          chartSection.appendChild(chartTitle);
          
          const chartContainer = document.createElement('div');
          chartContainer.className = 'chart-container';
          chartContainer.id = 'projection-chart-container';
          
          const canvas = document.createElement('canvas');
          canvas.id = 'projection-chart';
          chartContainer.appendChild(canvas);
          
          chartSection.appendChild(chartContainer);
          cashProjection.appendChild(chartSection);
          
          // Seção da tabela de projeção
          const tableSection = document.createElement('section');
          tableSection.className = 'projection-table-section';
          
          const tableTitle = document.createElement('h3');
          tableTitle.textContent = 'Detalhamento da Projeção';
          tableSection.appendChild(tableTitle);
          
          const tableContainer = document.createElement('div');
          tableContainer.className = 'table-container';
          tableContainer.id = 'projection-table-container';
          
          // Criar tabela de projeção
          const table = document.createElement('table');
          const thead = document.createElement('thead');
          const headerRow = document.createElement('tr');
          
          ['Período', 'Entradas', 'Saídas', 'Saldo do Período', 'Saldo Acumulado'].forEach(text => {
            const th = document.createElement('th');
            th.textContent = text;
            headerRow.appendChild(th);
          });
          
          thead.appendChild(headerRow);
          table.appendChild(thead);
          
          const tbody = document.createElement('tbody');
          
          if (projection.length === 0) {
            const emptyRow = document.createElement('tr');
            const emptyCell = document.createElement('td');
            emptyCell.colSpan = 5;
            emptyCell.textContent = 'Nenhuma projeção encontrada para o período selecionado';
            emptyCell.style.textAlign = 'center';
            emptyRow.appendChild(emptyCell);
            tbody.appendChild(emptyRow);
          } else {
            // Preparar dados para o gráfico
            const labels = [];
            const balanceData = [];
            
            // Adicionar linha para o saldo atual
            const currentRow = document.createElement('tr');
            
            const currentPeriodCell = document.createElement('td');
            currentPeriodCell.textContent = 'Atual';
            currentRow.appendChild(currentPeriodCell);
            
            const currentIncomeCell = document.createElement('td');
            currentIncomeCell.textContent = '-';
            currentRow.appendChild(currentIncomeCell);
            
            const currentExpenseCell = document.createElement('td');
            currentExpenseCell.textContent = '-';
            currentRow.appendChild(currentExpenseCell);
            
            const currentBalanceCell = document.createElement('td');
            currentBalanceCell.textContent = '-';
            currentRow.appendChild(currentBalanceCell);
            
            const currentAccumulatedCell = document.createElement('td');
            currentAccumulatedCell.textContent = utils.formatCurrency(currentBalance);
            currentAccumulatedCell.className = currentBalance >= 0 ? 'positive-amount' : 'negative-amount';
            currentRow.appendChild(currentAccumulatedCell);
            
            tbody.appendChild(currentRow);
            
            // Adicionar ponto inicial ao gráfico
            labels.push('Atual');
            balanceData.push(currentBalance);
            
            // Adicionar linhas para cada mês projetado
            projection.forEach((month, index) => {
              const row = document.createElement('tr');
              
              const periodCell = document.createElement('td');
              periodCell.textContent = `${month.month} ${month.year}`;
              row.appendChild(periodCell);
              
              const incomeCell = document.createElement('td');
              incomeCell.textContent = utils.formatCurrency(month.income);
              incomeCell.className = 'income-amount';
              row.appendChild(incomeCell);
              
              const expenseCell = document.createElement('td');
              expenseCell.textContent = utils.formatCurrency(month.expense);
              expenseCell.className = 'expense-amount';
              row.appendChild(expenseCell);
              
              const balanceCell = document.createElement('td');
              balanceCell.textContent = utils.formatCurrency(month.balance);
              balanceCell.className = month.balance >= 0 ? 'positive-amount' : 'negative-amount';
              row.appendChild(balanceCell);
              
              const accumulatedCell = document.createElement('td');
              accumulatedCell.textContent = utils.formatCurrency(month.runningBalance);
              accumulatedCell.className = month.runningBalance >= 0 ? 'positive-amount' : 'negative-amount';
              row.appendChild(accumulatedCell);
              
              tbody.appendChild(row);
              
              // Adicionar dados para o gráfico
              labels.push(`${month.month} ${month.year}`);
              balanceData.push(month.runningBalance);
            });
          }
          
          table.appendChild(tbody);
          tableContainer.appendChild(table);
          
          tableSection.appendChild(tableContainer);
          cashProjection.appendChild(tableSection);
          
          // Renderizar projeção de caixa
          contentArea.innerHTML = '';
          contentArea.appendChild(cashProjection);
          
          // Inicializar gráfico
          if (projection.length > 0) {
            const labels = ['Atual', ...projection.map(month => `${month.month} ${month.year}`)];
            const balanceData = [currentBalance, ...projection.map(month => month.runningBalance)];
            
            const ctx = document.getElementById('projection-chart').getContext('2d');
            
            new Chart(ctx, {
              type: 'line',
              data: {
                labels: labels,
                datasets: [{
                  label: 'Saldo Projetado',
                  backgroundColor: 'rgba(10, 132, 255, 0.1)',
                  borderColor: 'rgba(10, 132, 255, 1)',
                  data: balanceData,
                  fill: true,
                  tension: 0.4
                }]
              },
              options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                  tooltip: {
                    callbacks: {
                      label: function(context) {
                        return 'Saldo: ' + utils.formatCurrency(context.raw);
                      }
                    }
                  }
                },
                scales: {
                  y: {
                    beginAtZero: false,
                    ticks: {
                      callback: function(value) {
                        return utils.formatCurrency(value);
                      }
                    }
                  }
                }
              }
            });
          } else {
            document.getElementById('projection-chart-container').innerHTML = 
              '<div class="empty-chart-message">Sem dados para exibir</div>';
          }
          
          // Configurar eventos dos filtros
          periodFilter.addEventListener('change', () => {
            // Mostrar/ocultar grupo de período personalizado
            customPeriodGroup.style.display = 
              periodFilter.value === 'custom' ? 'flex' : 'none';
          });
          
          // Botão para aplicar filtros
          applyFiltersButton.addEventListener('click', () => {
            // Recarregar módulo com novos filtros
            cashProjectionModule.render();
          });
          
        } catch (error) {
          console.error("Erro ao renderizar projeção de caixa:", error);
          const contentArea = document.querySelector('.content-area');
          contentArea.innerHTML = '<div class="error-message">Erro ao carregar projeção de caixa</div>';
        }
      }
    };
  </script>
<!-- ===== FIM: BLOCO 18 ================================ -->

<!-- ===== INÍCIO: BLOCO 19 ============================== -->
  <script>
    // Módulo de Metas Financeiras
    const financialGoalsModule = {
      // Renderizar o módulo na área de conteúdo
      render: async () => {
        try {
          const contentArea = document.querySelector('.content-area');
          contentArea.innerHTML = '<div class="loading-spinner"><i class="fas fa-spinner fa-spin"></i></div>';
          
          // Carregar dados necessários
          const [goals, persons] = await Promise.all([
            firebaseService.goals.getAll(),
            firebaseService.persons.getAll()
          ]);
          
          // Criar mapa de pessoas para acesso rápido
          const personsMap = {};
          persons.forEach(person => {
            personsMap[person.id] = person;
          });
          
          // Carregar contribuições para cada meta
          const goalsWithContributions = await Promise.all(goals.map(async goal => {
            const contributions = await firebaseService.contributions.getByGoal(goal.id);
            return {
              ...goal,
              contributions,
              progress: utils.calculateGoalProgress(goal, contributions),
              remaining: utils.calculateRemainingAmount(goal, contributions),
              requiredMonthly: utils.calculateRequiredMonthlyContribution(goal, contributions)
            };
          }));
          
          // Separar metas ativas e concluídas
          const activeGoals = goalsWithContributions.filter(goal => goal.progress < 100);
          const completedGoals = goalsWithContributions.filter(goal => goal.progress >= 100);
          
          // Construir HTML das metas financeiras
          const financialGoals = document.createElement('div');
          
          // Botão para adicionar nova meta
          const addGoalSection = document.createElement('section');
          addGoalSection.className = 'add-goal-section';
          
          const addGoalButton = document.createElement('button');
          addGoalButton.className = 'btn btn-primary add-goal-btn';
          addGoalButton.innerHTML = '<i class="fas fa-plus"></i> Nova Meta';
          addGoalButton.addEventListener('click', () => {
            // Limpar formulário
            document.getElementById('goal-form').reset();
            document.getElementById('goal-id').value = '';
            document.getElementById('goal-deadline').value = '';
            document.getElementById('goal-modal-title').textContent = 'Nova Meta';
            
            // Preencher select de pessoas
            const goalPersonSelect = document.getElementById('goal-person');
            goalPersonSelect.innerHTML = '';
            
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = 'Selecione uma pessoa';
            goalPersonSelect.appendChild(defaultOption);
            
            persons.forEach(person => {
              const option = document.createElement('option');
              option.value = person.id;
              option.textContent = person.name;
              goalPersonSelect.appendChild(option);
            });
            
            // Mostrar modal
            const goalModal = document.getElementById('goal-modal');
            const modalOverlay = document.getElementById('modal-overlay');
            
            modalOverlay.classList.add('active');
            goalModal.classList.add('active');
          });
          
          addGoalSection.appendChild(addGoalButton);
          financialGoals.appendChild(addGoalSection);
          
          // Seção de metas ativas
          const activeGoalsSection = document.createElement('section');
          activeGoalsSection.className = 'active-goals-section';
          
          const activeGoalsTitle = document.createElement('h3');
          activeGoalsTitle.textContent = 'Metas Ativas';
          activeGoalsSection.appendChild(activeGoalsTitle);
          
          if (activeGoals.length === 0) {
            const emptyMessage = document.createElement('p');
            emptyMessage.className = 'empty-message';
            emptyMessage.textContent = 'Nenhuma meta ativa encontrada. Clique em "Nova Meta" para começar.';
            activeGoalsSection.appendChild(emptyMessage);
          } else {
            const goalsGrid = document.createElement('div');
            goalsGrid.className = 'goals-grid';
            
            // Criar cards para cada meta ativa
            activeGoals.forEach(goal => {
              const goalCard = financialGoalsModule.createGoalCard(goal, personsMap);
              goalsGrid.appendChild(goalCard);
            });
            
            activeGoalsSection.appendChild(goalsGrid);
          }
          
          financialGoals.appendChild(activeGoalsSection);
          
          // Seção de metas concluídas
          if (completedGoals.length > 0) {
            const completedGoalsSection = document.createElement('section');
            completedGoalsSection.className = 'completed-goals-section';
            
            const completedGoalsTitle = document.createElement('h3');
            completedGoalsTitle.textContent = 'Metas Concluídas';
            completedGoalsSection.appendChild(completedGoalsTitle);
            
            const goalsGrid = document.createElement('div');
            goalsGrid.className = 'goals-grid';
            
            // Criar cards para cada meta concluída
            completedGoals.forEach(goal => {
              const goalCard = financialGoalsModule.createGoalCard(goal, personsMap);
              goalsGrid.appendChild(goalCard);
            });
            
            completedGoalsSection.appendChild(goalsGrid);
            financialGoals.appendChild(completedGoalsSection);
          }
          
          // Renderizar metas financeiras
          contentArea.innerHTML = '';
          contentArea.appendChild(financialGoals);
          
          // Configurar form do modal de contribuição
          const contributionForm = document.getElementById('contribution-form');
          contributionForm.addEventListener('submit', async (event) => {
            event.preventDefault();
            
            // Obter valores do formulário
            const goalId = document.getElementById('contribution-goal-id').value;
            const amount = document.getElementById('contribution-amount').value;
            const date = document.getElementById('contribution-date').value;
            const notes = document.getElementById('contribution-notes').value.trim();
            
            // Validação básica
            if (!amount || parseFloat(amount) <= 0) {
              utils.showToast("Valor deve ser maior que zero", "error");
              return;
            }
            
            if (!date) {
              utils.showToast("Data é obrigatória", "error");
              return;
            }
            
            // Criar objeto de contribuição
            const contribution = {
              goalId,
              amount,
              date,
              notes
            };
            
            try {
              // Adicionar contribuição
              await firebaseService.contributions.add(contribution);
              
              // Fechar modal
              const contributionModal = document.getElementById('contribution-modal');
              const modalOverlay = document.getElementById('modal-overlay');
              
              modalOverlay.classList.remove('active');
              contributionModal.classList.remove('active');
              
              // Recarregar módulo
              financialGoalsModule.render();
            } catch (error) {
              console.error("Erro ao adicionar contribuição:", error);
            }
          });
          
          // Configurar form do modal de meta
          const goalForm = document.getElementById('goal-form');
          goalForm.addEventListener('submit', async (event) => {
            event.preventDefault();
            
            // Obter valores do formulário
            const goalId = document.getElementById('goal-id').value;
            const name = document.getElementById('goal-name').value.trim();
            const target = document.getElementById('goal-target').value;
            const deadline = document.getElementById('goal-deadline').value;
            const personId = document.getElementById('goal-person').value;
            const purpose = document.getElementById('goal-purpose').value.trim();
            const icon = document.getElementById('goal-icon').value;
            const color = document.getElementById('goal-color').value;
            
            // Validação básica
            if (!name) {
              utils.showToast("Nome da meta é obrigatório", "error");
              return;
            }
            
            if (!target || parseFloat(target) <= 0) {
              utils.showToast("Valor alvo deve ser maior que zero", "error");
              return;
            }
            
            if (!deadline) {
              utils.showToast("Prazo final é obrigatório", "error");
              return;
            }
            
            // Criar objeto de meta
            const goal = {
              name,
              target,
              deadline,
              personId,
              purpose,
              icon,
              color
            };
            
            try {
              // Adicionar ou atualizar meta
              if (goalId) {
                await firebaseService.goals.update(goalId, goal);
              } else {
                await firebaseService.goals.add(goal);
              }
              
              // Fechar modal
              const goalModal = document.getElementById('goal-modal');
              const modalOverlay = document.getElementById('modal-overlay');
              
              modalOverlay.classList.remove('active');
              goalModal.classList.remove('active');
              
              // Recarregar módulo
              financialGoalsModule.render();
            } catch (error) {
              console.error("Erro ao salvar meta:", error);
            }
          });
          
          // Configurar seletor de ícones
          const goalSelectedIcon = document.getElementById('goal-selected-icon');
          const goalIconInput = document.getElementById('goal-icon');
          const goalIconGrid = document.getElementById('goal-icon-grid');
          
          goalSelectedIcon.addEventListener('click', () => {
            goalIconGrid.classList.toggle('show');
          });
          
          const iconItems = goalIconGrid.querySelectorAll('.icon-item');
          iconItems.forEach(item => {
            item.addEventListener('click', () => {
              const icon = item.getAttribute('data-icon');
              goalIconInput.value = icon;
              goalSelectedIcon.innerHTML = `<i class="fas ${icon}"></i>`;
              goalIconGrid.classList.remove('show');
            });
          });
          
          // Esconder grid de ícones quando clicar fora
          document.addEventListener('click', (event) => {
            if (!goalSelectedIcon.contains(event.target) && !goalIconGrid.contains(event.target)) {
              goalIconGrid.classList.remove('show');
            }
          });
          
        } catch (error) {
          console.error("Erro ao renderizar metas financeiras:", error);
          const contentArea = document.querySelector('.content-area');
          contentArea.innerHTML = '<div class="error-message">Erro ao carregar metas financeiras</div>';
        }
      },
      
      // Criar card de meta
      createGoalCard: (goal, personsMap) => {
        const card = document.createElement('div');
        card.className = 'goal-card';
        card.style.borderLeft = `4px solid ${goal.color || '#0A84FF'}`;
        
        // Cabeçalho do card
        const cardHeader = document.createElement('div');
        cardHeader.className = 'goal-card-header';
        
        // Ícone da meta
        const iconContainer = document.createElement('div');
        iconContainer.className = 'goal-icon';
        iconContainer.style.backgroundColor = goal.color || '#0A84FF';
        
        const icon = document.createElement('i');
        icon.className = `fas ${goal.icon || 'fa-bullseye'}`;
        iconContainer.appendChild(icon);
        
        cardHeader.appendChild(iconContainer);
        
        // Informações do cabeçalho
        const headerInfo = document.createElement('div');
        headerInfo.className = 'goal-header-info';
        
        // Nome da meta
        const goalName = document.createElement('h4');
        goalName.className = 'goal-name';
        goalName.textContent = goal.name;
        headerInfo.appendChild(goalName);
        
        // Pessoa responsável
        const goalPerson = document.createElement('div');
        goalPerson.className = 'goal-person';
        
        const person = personsMap[goal.personId];
        goalPerson.textContent = person ? person.name : 'Sem pessoa';
        
        headerInfo.appendChild(goalPerson);
        cardHeader.appendChild(headerInfo);
        
        // Ações do card
        const cardActions = document.createElement('div');
        cardActions.className = 'goal-card-actions';
        
        // Botão de edição
        const editButton = document.createElement('button');
        editButton.className = 'card-action-btn';
        editButton.innerHTML = '<i class="fas fa-edit"></i>';
        editButton.title = 'Editar Meta';
        editButton.addEventListener('click', () => {
          // Preencher formulário com dados da meta
          document.getElementById('goal-id').value = goal.id;
          document.getElementById('goal-name').value = goal.name;
          document.getElementById('goal-target').value = goal.target;
          document.getElementById('goal-deadline').value = utils.formatDateForInput(goal.deadline);
          document.getElementById('goal-purpose').value = goal.purpose || '';
          document.getElementById('goal-icon').value = goal.icon || 'fa-bullseye';
          document.getElementById('goal-color').value = goal.color || '#0A84FF';
          
          // Atualizar ícone selecionado
          document.getElementById('goal-selected-icon').innerHTML = 
            `<i class="fas ${goal.icon || 'fa-bullseye'}"></i>`;
          
          // Preencher select de pessoas
          const goalPersonSelect = document.getElementById('goal-person');
          goalPersonSelect.innerHTML = '';
          
          const defaultOption = document.createElement('option');
          defaultOption.value = '';
          defaultOption.textContent = 'Selecione uma pessoa';
          goalPersonSelect.appendChild(defaultOption);
          
          Object.values(personsMap).forEach(person => {
            const option = document.createElement('option');
            option.value = person.id;
            option.textContent = person.name;
            goalPersonSelect.appendChild(option);
          });
          
          goalPersonSelect.value = goal.personId || '';
          
          // Atualizar título do modal
          document.getElementById('goal-modal-title').textContent = 'Editar Meta';
          
          // Mostrar modal
          const goalModal = document.getElementById('goal-modal');
          const modalOverlay = document.getElementById('modal-overlay');
          
          modalOverlay.classList.add('active');
          goalModal.classList.add('active');
        });
        
        cardActions.appendChild(editButton);
        
        // Botão de exclusão
        const deleteButton = document.createElement('button');
        deleteButton.className = 'card-action-btn';
        deleteButton.innerHTML = '<i class="fas fa-trash-alt"></i>';
        deleteButton.title = 'Excluir Meta';
        deleteButton.addEventListener('click', () => {
          utils.showConfirmDialog(
            'Confirmar Exclusão',
            'Tem certeza que deseja excluir esta meta? Todas as contribuições associadas também serão removidas.',
            async () => {
              await firebaseService.goals.remove(goal.id);
              financialGoalsModule.render();
            }
          );
        });
        
        cardActions.appendChild(deleteButton);
        
        // Botão de aporte
        const contributionButton = document.createElement('button');
        contributionButton.className = 'card-action-btn';
        contributionButton.innerHTML = '<i class="fas fa-plus-circle"></i>';
        contributionButton.title = 'Adicionar Aporte';
        contributionButton.addEventListener('click', () => {
          // Preparar modal de aporte
          document.getElementById('contribution-form').reset();
          document.getElementById('contribution-goal-id').value = goal.id;
          document.getElementById('contribution-date').value = utils.getCurrentDateForInput();
          document.getElementById('contribution-modal-title').textContent = `Novo Aporte para: ${goal.name}`;
          
          // Mostrar modal
          const contributionModal = document.getElementById('contribution-modal');
          const modalOverlay = document.getElementById('modal-overlay');
          
          modalOverlay.classList.add('active');
          contributionModal.classList.add('active');
        });
        
        cardActions.appendChild(contributionButton);
        cardHeader.appendChild(cardActions);
        
        card.appendChild(cardHeader);
        
        // Corpo do card
        const cardBody = document.createElement('div');
        cardBody.className = 'goal-card-body';
        
        // Progresso
        const progressContainer = document.createElement('div');
        progressContainer.className = 'goal-progress-container';
        
        const progressBar = document.createElement('div');
        progressBar.className = 'goal-progress-bar';
        
        const progressFill = document.createElement('div');
        progressFill.className = 'goal-progress-fill';
        progressFill.style.width = `${goal.progress}%`;
        progressFill.style.backgroundColor = goal.color || '#0A84FF';
        progressBar.appendChild(progressFill);
        
        const progressLabel = document.createElement('div');
        progressLabel.className = 'goal-progress-label';
        progressLabel.textContent = `${goal.progress.toFixed(1)}%`;
        progressBar.appendChild(progressLabel);
        
        progressContainer.appendChild(progressBar);
        cardBody.appendChild(progressContainer);
        
        // Detalhes da meta
        const goalDetails = document.createElement('div');
        goalDetails.className = 'goal-details';
        
        // Valor alvo
        const targetContainer = document.createElement('div');
        targetContainer.className = 'goal-detail';
        
        const targetLabel = document.createElement('span');
        targetLabel.className = 'goal-detail-label';
        targetLabel.textContent = 'Valor Alvo:';
        targetContainer.appendChild(targetLabel);
        
        const targetValue = document.createElement('span');
        targetValue.className = 'goal-detail-value';
        targetValue.textContent = utils.formatCurrency(goal.target);
        targetContainer.appendChild(targetValue);
        
        goalDetails.appendChild(targetContainer);
        
        // Valor acumulado
        const accumulatedContainer = document.createElement('div');
        accumulatedContainer.className = 'goal-detail';
        
        const accumulatedLabel = document.createElement('span');
        accumulatedLabel.className = 'goal-detail-label';
        accumulatedLabel.textContent = 'Acumulado:';
        accumulatedContainer.appendChild(accumulatedLabel);
        
        const accumulated = parseFloat(goal.target) - goal.remaining;
        const accumulatedValue = document.createElement('span');
        accumulatedValue.className = 'goal-detail-value';
        accumulatedValue.textContent = utils.formatCurrency(accumulated);
        accumulatedContainer.appendChild(accumulatedValue);
        
        goalDetails.appendChild(accumulatedContainer);
        
        // Valor restante
        const remainingContainer = document.createElement('div');
        remainingContainer.className = 'goal-detail';
        
        const remainingLabel = document.createElement('span');
        remainingLabel.className = 'goal-detail-label';
        remainingLabel.textContent = 'Restante:';
        remainingContainer.appendChild(remainingLabel);
        
        const remainingValue = document.createElement('span');
        remainingValue.className = 'goal-detail-value';
        remainingValue.textContent = utils.formatCurrency(goal.remaining);
        remainingContainer.appendChild(remainingValue);
        
        goalDetails.appendChild(remainingContainer);
        
        // Prazo final
        const deadlineContainer = document.createElement('div');
        deadlineContainer.className = 'goal-detail';
        
        const deadlineLabel = document.createElement('span');
        deadlineLabel.className = 'goal-detail-label';
        deadlineLabel.textContent = 'Prazo Final:';
        deadlineContainer.appendChild(deadlineLabel);
        
        const deadlineValue = document.createElement('span');
        deadlineValue.className = 'goal-detail-value';
        deadlineValue.textContent = utils.formatDate(goal.deadline);
        deadlineContainer.appendChild(deadlineValue);
        
        goalDetails.appendChild(deadlineContainer);
        
        // Aporte mensal necessário
        if (goal.requiredMonthly > 0) {
          const monthlyContainer = document.createElement('div');
          monthlyContainer.className = 'goal-detail';
          
          const monthlyLabel = document.createElement('span');
          monthlyLabel.className = 'goal-detail-label';
          monthlyLabel.textContent = 'Aporte Mensal Necessário:';
          monthlyContainer.appendChild(monthlyLabel);
          
          const monthlyValue = document.createElement('span');
          monthlyValue.className = 'goal-detail-value';
          monthlyValue.textContent = utils.formatCurrency(goal.requiredMonthly);
          monthlyContainer.appendChild(monthlyValue);
          
          goalDetails.appendChild(monthlyContainer);
        }
        
        cardBody.appendChild(goalDetails);
        
        // Propósito (se existir)
        if (goal.purpose) {
          const purposeContainer = document.createElement('div');
          purposeContainer.className = 'goal-purpose';
          
          const purposeLabel = document.createElement('span');
          purposeLabel.className = 'goal-purpose-label';
          purposeLabel.textContent = 'Propósito:';
          purposeContainer.appendChild(purposeLabel);
          
          const purposeValue = document.createElement('p');
          purposeValue.className = 'goal-purpose-value';
          purposeValue.textContent = goal.purpose;
          purposeContainer.appendChild(purposeValue);
          
          cardBody.appendChild(purposeContainer);
        }
        
        card.appendChild(cardBody);
        
        // Rodapé do card (contribuições)
        if (goal.contributions && goal.contributions.length > 0) {
          const cardFooter = document.createElement('div');
          cardFooter.className = 'goal-card-footer';
          
          const contributionsLabel = document.createElement('h5');
          contributionsLabel.textContent = 'Últimos Aportes';
          cardFooter.appendChild(contributionsLabel);
          
          // Ordenar contribuições pela data (mais recentes primeiro)
          const sortedContributions = [...goal.contributions].sort((a, b) => {
            const dateA = new Date(a.date);
            const dateB = new Date(b.date);
            return dateB - dateA;
          });
          
          // Mostrar apenas as 3 últimas contribuições
          const recentContributions = sortedContributions.slice(0, 3);
          
          const contributionsList = document.createElement('ul');
          contributionsList.className = 'contributions-list';
          
          recentContributions.forEach(contribution => {
            const item = document.createElement('li');
            item.className = 'contribution-item';
            
            const contributionDate = document.createElement('span');
            contributionDate.className = 'contribution-date';
            contributionDate.textContent = utils.formatDate(contribution.date);
            item.appendChild(contributionDate);
            
            const contributionAmount = document.createElement('span');
            contributionAmount.className = 'contribution-amount';
            contributionAmount.textContent = utils.formatCurrency(contribution.amount);
            item.appendChild(contributionAmount);
            
            const deleteBtn = document.createElement('button');
            deleteBtn.className = 'contribution-delete-btn';
            deleteBtn.innerHTML = '<i class="fas fa-times"></i>';
            deleteBtn.title = 'Remover Contribuição';
            deleteBtn.addEventListener('click', (event) => {
              event.stopPropagation();
              
              utils.showConfirmDialog(
                'Confirmar Exclusão',
                'Tem certeza que deseja excluir esta contribuição?',
                async () => {
                  await firebaseService.contributions.remove(contribution.id);
                  financialGoalsModule.render();
                }
              );
            });
            item.appendChild(deleteBtn);
            
            contributionsList.appendChild(item);
          });
          
          cardFooter.appendChild(contributionsList);
          
          // Botão para ver todas as contribuições
          if (goal.contributions.length > 3) {
            const viewAllBtn = document.createElement('button');
            viewAllBtn.className = 'view-all-contributions-btn';
            viewAllBtn.textContent = 'Ver todos os aportes';
            viewAllBtn.addEventListener('click', () => {
              // Mostrar modal com todas as contribuições
              // Implementar mais tarde
              utils.showToast("Funcionalidade em desenvolvimento", "info");
            });
            
            cardFooter.appendChild(viewAllBtn);
          }
          
          card.appendChild(cardFooter);
        }
        
        return card;
      }
    };
  </script>
<!-- ===== FIM: BLOCO 19 ================================ -->

<!-- ===== INÍCIO: BLOCO 20 ============================== -->
  <script>
    // Módulo de Configurações - Gerenciamento de categorias, pessoas e cartões
    const settingsModule = {
      // Renderizar o módulo na área de conteúdo
      render: async () => {
        try {
          const contentArea = document.querySelector('.content-area');
          contentArea.innerHTML = '<div class="loading-spinner"><i class="fas fa-spinner fa-spin"></i></div>';
          
          // Carregar dados necessários
          const [categories, persons, cards] = await Promise.all([
            firebaseService.categories.getAll(),
            firebaseService.persons.getAll(),
            firebaseService.cards.getAll()
          ]);
          
          // Construir HTML das configurações
          const settings = document.createElement('div');
          settings.className = 'settings-container';
          
          // Tabs de configuração
          const tabsContainer = document.createElement('div');
          tabsContainer.className = 'tabs-container';
          
          const tabsList = document.createElement('ul');
          tabsList.className = 'tabs-list';
          
          // Tab de Categorias
          const categoriesTab = document.createElement('li');
          categoriesTab.className = 'tab active';
          categoriesTab.setAttribute('data-tab', 'categories');
          categoriesTab.textContent = 'Categorias';
          tabsList.appendChild(categoriesTab);
          
          // Tab de Pessoas
          const personsTab = document.createElement('li');
          personsTab.className = 'tab';
          personsTab.setAttribute('data-tab', 'persons');
          personsTab.textContent = 'Pessoas';
          tabsList.appendChild(personsTab);
          
          // Tab de Cartões
          const cardsTab = document.createElement('li');
          cardsTab.className = 'tab';
          cardsTab.setAttribute('data-tab', 'cards');
          cardsTab.textContent = 'Cartões de Crédito';
          tabsList.appendChild(cardsTab);
          
          tabsContainer.appendChild(tabsList);
          settings.appendChild(tabsContainer);
          
          // Conteúdo das tabs
          const tabsContent = document.createElement('div');
          tabsContent.className = 'tabs-content';
          
          // Conteúdo de Categorias
          const categoriesContent = document.createElement('div');
          categoriesContent.className = 'tab-content active';
          categoriesContent.setAttribute('id', 'categories-content');
          
          const categoriesHeader = document.createElement('div');
          categoriesHeader.className = 'tab-content-header';
          
          const categoriesTitle = document.createElement('h3');
          categoriesTitle.textContent = 'Gerenciar Categorias';
          categoriesHeader.appendChild(categoriesTitle);
          
          const addCategoryButton = document.createElement('button');
          addCategoryButton.className = 'btn btn-primary';
          addCategoryButton.innerHTML = '<i class="fas fa-plus"></i> Nova Categoria';
          addCategoryButton.addEventListener('click', () => {
            // Limpar formulário
            document.getElementById('category-form').reset();
            document.getElementById('category-id').value = '';
            document.getElementById('category-modal-title').textContent = 'Nova Categoria';
            document.getElementById('selected-icon').innerHTML = '<i class="fas fa-tag"></i>';
            document.getElementById('category-icon').value = 'fa-tag';
            
            // Mostrar modal
            const categoryModal = document.getElementById('category-modal');
            const modalOverlay = document.getElementById('modal-overlay');
            
            modalOverlay.classList.add('active');
            categoryModal.classList.add('active');
          });
          
          categoriesHeader.appendChild(addCategoryButton);
          categoriesContent.appendChild(categoriesHeader);
          
          // Tabela de categorias
          const categoriesTable = document.createElement('table');
          categoriesTable.className = 'settings-table';
          
          const categoriesThead = document.createElement('thead');
          const categoriesHeaderRow = document.createElement('tr');
          
          ['', 'Nome', 'Ícone', 'Cor', 'Ações'].forEach(text => {
            const th = document.createElement('th');
            th.textContent = text;
            categoriesHeaderRow.appendChild(th);
          });
          
          categoriesThead.appendChild(categoriesHeaderRow);
          categoriesTable.appendChild(categoriesThead);
          
          const categoriesTbody = document.createElement('tbody');
          
          if (categories.length === 0) {
            const emptyRow = document.createElement('tr');
            const emptyCell = document.createElement('td');
            emptyCell.colSpan = 5;
            emptyCell.textContent = 'Nenhuma categoria encontrada. Clique em "Nova Categoria" para adicionar.';
            emptyCell.style.textAlign = 'center';
            emptyRow.appendChild(emptyCell);
            categoriesTbody.appendChild(emptyRow);
          } else {
            categories.forEach(category => {
              const row = document.createElement('tr');
              
              // Cor (como indicador)
              const colorCell = document.createElement('td');
              const colorIndicator = document.createElement('div');
              colorIndicator.className = 'color-indicator';
              colorIndicator.style.backgroundColor = category.color || '#0A84FF';
              colorCell.appendChild(colorIndicator);
              row.appendChild(colorCell);
              
              // Nome
              const nameCell = document.createElement('td');
              nameCell.textContent = category.name;
              row.appendChild(nameCell);
              
              // Ícone
              const iconCell = document.createElement('td');
              const icon = document.createElement('i');
              icon.className = `fas ${category.icon || 'fa-tag'}`;
              icon.style.color = category.color || '#0A84FF';
              iconCell.appendChild(icon);
              row.appendChild(iconCell);
              
              // Cor (como texto)
              const colorTextCell = document.createElement('td');
              colorTextCell.textContent = category.color || '#0A84FF';
              row.appendChild(colorTextCell);
              
              // Ações
              const actionsCell = document.createElement('td');
              actionsCell.className = 'table-action-buttons';
              
              // Botão de edição
              const editBtn = document.createElement('button');
              editBtn.className = 'table-action-btn';
              editBtn.innerHTML = '<i class="fas fa-edit"></i>';
              editBtn.title = 'Editar';
              editBtn.addEventListener('click', () => {
                // Preencher formulário com dados da categoria
                document.getElementById('category-id').value = category.id;
                document.getElementById('category-name').value = category.name;
                document.getElementById('category-icon').value = category.icon || 'fa-tag';
                document.getElementById('category-color').value = category.color || '#0A84FF';
                
                // Atualizar ícone selecionado
                document.getElementById('selected-icon').innerHTML = 
                  `<i class="fas ${category.icon || 'fa-tag'}"></i>`;
                
                // Atualizar título do modal
                document.getElementById('category-modal-title').textContent = 'Editar Categoria';
                
                // Mostrar modal
                const categoryModal = document.getElementById('category-modal');
                const modalOverlay = document.getElementById('modal-overlay');
                
                modalOverlay.classList.add('active');
                categoryModal.classList.add('active');
              });
              actionsCell.appendChild(editBtn);
              
              // Botão de exclusão
              const deleteBtn = document.createElement('button');
              deleteBtn.className = 'table-action-btn';
              deleteBtn.innerHTML = '<i class="fas fa-trash-alt"></i>';
              deleteBtn.title = 'Excluir';
              deleteBtn.addEventListener('click', () => {
                utils.showConfirmDialog(
                  'Confirmar Exclusão',
                  'Tem certeza que deseja excluir esta categoria? Isso pode afetar transações existentes.',
                  async () => {
                    try {
                      const result = await firebaseService.categories.remove(category.id);
                      if (result) {
                        utils.showToast("Categoria removida com sucesso", "success");
                        settingsModule.render();
                      }
                    } catch (error) {
                      console.error("Erro ao remover categoria:", error);
                    }
                  }
                );
              });
              actionsCell.appendChild(deleteBtn);
              
              row.appendChild(actionsCell);
              categoriesTbody.appendChild(row);
            });
          }
          
          categoriesTable.appendChild(categoriesTbody);
          categoriesContent.appendChild(categoriesTable);
          
          // Conteúdo de Pessoas
          const personsContent = document.createElement('div');
          personsContent.className = 'tab-content';
          personsContent.setAttribute('id', 'persons-content');
          
          const personsHeader = document.createElement('div');
          personsHeader.className = 'tab-content-header';
          
          const personsTitle = document.createElement('h3');
          personsTitle.textContent = 'Gerenciar Pessoas';
          personsHeader.appendChild(personsTitle);
          
          const addPersonButton = document.createElement('button');
          addPersonButton.className = 'btn btn-primary';
          addPersonButton.innerHTML = '<i class="fas fa-plus"></i> Nova Pessoa';
          addPersonButton.addEventListener('click', () => {
            // Limpar formulário
            document.getElementById('person-form').reset();
            document.getElementById('person-id').value = '';
            document.getElementById('person-modal-title').textContent = 'Nova Pessoa';
            
            // Mostrar modal
            const personModal = document.getElementById('person-modal');
            const modalOverlay = document.getElementById('modal-overlay');
            
            modalOverlay.classList.add('active');
            personModal.classList.add('active');
          });
          
          personsHeader.appendChild(addPersonButton);
          personsContent.appendChild(personsHeader);
          
          // Tabela de pessoas
          const personsTable = document.createElement('table');
          personsTable.className = 'settings-table';
          
          const personsThead = document.createElement('thead');
          const personsHeaderRow = document.createElement('tr');
          
          ['Avatar', 'Nome', 'Ações'].forEach(text => {
            const th = document.createElement('th');
            th.textContent = text;
            personsHeaderRow.appendChild(th);
          });
          
          personsThead.appendChild(personsHeaderRow);
          personsTable.appendChild(personsThead);
          
          const personsTbody = document.createElement('tbody');
          
          if (persons.length === 0) {
            const emptyRow = document.createElement('tr');
            const emptyCell = document.createElement('td');
            emptyCell.colSpan = 3;
            emptyCell.textContent = 'Nenhuma pessoa encontrada. Clique em "Nova Pessoa" para adicionar.';
            emptyCell.style.textAlign = 'center';
            emptyRow.appendChild(emptyCell);
            personsTbody.appendChild(emptyRow);
          } else {
            persons.forEach(person => {
              const row = document.createElement('tr');
              
              // Avatar
              const avatarCell = document.createElement('td');
              const avatar = document.createElement('div');
              avatar.className = 'avatar';
              avatar.classList.add(person.avatar || 'avatar-1');
              avatarCell.appendChild(avatar);
              row.appendChild(avatarCell);
              
              // Nome
              const nameCell = document.createElement('td');
              nameCell.textContent = person.name;
              row.appendChild(nameCell);
              
              // Ações
              const actionsCell = document.createElement('td');
              actionsCell.className = 'table-action-buttons';
              
              // Botão de edição
              const editBtn = document.createElement('button');
              editBtn.className = 'table-action-btn';
              editBtn.innerHTML = '<i class="fas fa-edit"></i>';
              editBtn.title = 'Editar';
              editBtn.addEventListener('click', () => {
                // Preencher formulário com dados da pessoa
                document.getElementById('person-id').value = person.id;
                document.getElementById('person-name').value = person.name;
                document.getElementById('person-avatar').value = person.avatar || 'avatar-1';
                
                // Atualizar avatar selecionado
                const selectedAvatar = document.getElementById('selected-avatar');
                selectedAvatar.innerHTML = '';
                
                const avatarElement = document.createElement('div');
                avatarElement.className = 'avatar-item';
                avatarElement.classList.add(person.avatar || 'avatar-1');
                
                selectedAvatar.appendChild(avatarElement);
                
                // Atualizar título do modal
                document.getElementById('person-modal-title').textContent = 'Editar Pessoa';
                
                // Mostrar modal
                const personModal = document.getElementById('person-modal');
                const modalOverlay = document.getElementById('modal-overlay');
                
                modalOverlay.classList.add('active');
                personModal.classList.add('active');
              });
              actionsCell.appendChild(editBtn);
              
              // Botão de exclusão
              const deleteBtn = document.createElement('button');
              deleteBtn.className = 'table-action-btn';
              deleteBtn.innerHTML = '<i class="fas fa-trash-alt"></i>';
              deleteBtn.title = 'Excluir';
              deleteBtn.addEventListener('click', () => {
                utils.showConfirmDialog(
                  'Confirmar Exclusão',
                  'Tem certeza que deseja excluir esta pessoa? Isso pode afetar transações existentes.',
                  async () => {
                    try {
                      const result = await firebaseService.persons.remove(person.id);
                      if (result) {
                        utils.showToast("Pessoa removida com sucesso", "success");
                        settingsModule.render();
                      }
                    } catch (error) {
                      console.error("Erro ao remover pessoa:", error);
                    }
                  }
                );
              });
              actionsCell.appendChild(deleteBtn);
              
              row.appendChild(actionsCell);
              personsTbody.appendChild(row);
            });
          }
          
          personsTable.appendChild(personsTbody);
          personsContent.appendChild(personsTable);
          
          // Conteúdo de Cartões
          const cardsContent = document.createElement('div');
          cardsContent.className = 'tab-content';
          cardsContent.setAttribute('id', 'cards-content');
          
          const cardsHeader = document.createElement('div');
          cardsHeader.className = 'tab-content-header';
          
          const cardsTitle = document.createElement('h3');
          cardsTitle.textContent = 'Gerenciar Cartões de Crédito';
          cardsHeader.appendChild(cardsTitle);
          
          const addCardButton = document.createElement('button');
          addCardButton.className = 'btn btn-primary';
          addCardButton.innerHTML = '<i class="fas fa-plus"></i> Novo Cartão';
          addCardButton.addEventListener('click', () => {
            // Limpar formulário
            document.getElementById('card-form').reset();
            document.getElementById('card-id').value = '';
            document.getElementById('card-modal-title').textContent = 'Novo Cartão';
            
            // Mostrar modal
            const cardModal = document.getElementById('card-modal');
            const modalOverlay = document.getElementById('modal-overlay');
            
            modalOverlay.classList.add('active');
            cardModal.classList.add('active');
          });
          
          cardsHeader.appendChild(addCardButton);
          cardsContent.appendChild(cardsHeader);
          
          // Tabela de cartões
          const cardsTable = document.createElement('table');
          cardsTable.className = 'settings-table';
          
          const cardsThead = document.createElement('thead');
          const cardsHeaderRow = document.createElement('tr');
          
          ['', 'Nome', 'Limite', 'Fechamento', 'Vencimento', 'Ações'].forEach(text => {
            const th = document.createElement('th');
            th.textContent = text;
            cardsHeaderRow.appendChild(th);
          });
          
          cardsThead.appendChild(cardsHeaderRow);
          cardsTable.appendChild(cardsThead);
          
          const cardsTbody = document.createElement('tbody');
          
          if (cards.length === 0) {
            const emptyRow = document.createElement('tr');
            const emptyCell = document.createElement('td');
            emptyCell.colSpan = 6;
            emptyCell.textContent = 'Nenhum cartão encontrado. Clique em "Novo Cartão" para adicionar.';
            emptyCell.style.textAlign = 'center';
            emptyRow.appendChild(emptyCell);
            cardsTbody.appendChild(emptyRow);
          } else {
            cards.forEach(card => {
              const row = document.createElement('tr');
              
              // Cor (como indicador)
              const colorCell = document.createElement('td');
              const colorIndicator = document.createElement('div');
              colorIndicator.className = 'color-indicator';
              colorIndicator.style.backgroundColor = card.color || '#FF453A';
              colorCell.appendChild(colorIndicator);
              row.appendChild(colorCell);
              
              // Nome
              const nameCell = document.createElement('td');
              nameCell.textContent = card.name;
              row.appendChild(nameCell);
              
              // Limite
              const limitCell = document.createElement('td');
              limitCell.textContent = card.limit ? utils.formatCurrency(card.limit) : '-';
              row.appendChild(limitCell);
              
              // Dia de Fechamento
              const closingDayCell = document.createElement('td');
              closingDayCell.textContent = card.closingDay ? `Dia ${card.closingDay}` : '-';
              row.appendChild(closingDayCell);
              
              // Dia de Vencimento
              const dueDayCell = document.createElement('td');
              dueDayCell.textContent = card.dueDay ? `Dia ${card.dueDay}` : '-';
              row.appendChild(dueDayCell);
              
              // Ações
              const actionsCell = document.createElement('td');
              actionsCell.className = 'table-action-buttons';
              
              // Botão de edição
              const editBtn = document.createElement('button');
              editBtn.className = 'table-action-btn';
              editBtn.innerHTML = '<i class="fas fa-edit"></i>';
              editBtn.title = 'Editar';
              editBtn.addEventListener('click', () => {
                // Preencher formulário com dados do cartão
                document.getElementById('card-id').value = card.id;
                document.getElementById('card-name').value = card.name;
                document.getElementById('card-limit').value = card.limit || '';
                document.getElementById('card-closing-day').value = card.closingDay || '';
                document.getElementById('card-due-day').value = card.dueDay || '';
                document.getElementById('card-color').value = card.color || '#FF453A';
                
                // Atualizar título do modal
                document.getElementById('card-modal-title').textContent = 'Editar Cartão';
                
                // Mostrar modal
                const cardModal = document.getElementById('card-modal');
                const modalOverlay = document.getElementById('modal-overlay');
                
                modalOverlay.classList.add('active');
                cardModal.classList.add('active');
              });
              actionsCell.appendChild(editBtn);
              
              // Botão de exclusão
              const deleteBtn = document.createElement('button');
              deleteBtn.className = 'table-action-btn';
              deleteBtn.innerHTML = '<i class="fas fa-trash-alt"></i>';
              deleteBtn.title = 'Excluir';
              deleteBtn.addEventListener('click', () => {
                utils.showConfirmDialog(
                  'Confirmar Exclusão',
                  'Tem certeza que deseja excluir este cartão? Isso pode afetar transações existentes.',
                  async () => {
                    try {
                      const result = await firebaseService.cards.remove(card.id);
                      if (result) {
                        utils.showToast("Cartão removido com sucesso", "success");
                        settingsModule.render();
                      }
                    } catch (error) {
                      console.error("Erro ao remover cartão:", error);
                    }
                  }
                );
              });
              actionsCell.appendChild(deleteBtn);
              
              row.appendChild(actionsCell);
              cardsTbody.appendChild(row);
            });
          }
          
          cardsTable.appendChild(cardsTbody);
          cardsContent.appendChild(cardsTable);
          
          // Adicionar conteúdos das tabs ao container
          tabsContent.appendChild(categoriesContent);
          tabsContent.appendChild(personsContent);
          tabsContent.appendChild(cardsContent);
          
          settings.appendChild(tabsContent);
          
          // Renderizar configurações
          contentArea.innerHTML = '';
          contentArea.appendChild(settings);
          
          // Configurar navegação entre tabs
          const tabs = document.querySelectorAll('.tab');
          tabs.forEach(tab => {
            tab.addEventListener('click', () => {
              // Remover classe active de todas as tabs
              tabs.forEach(t => t.classList.remove('active'));
              
              // Adicionar classe active à tab clicada
              tab.classList.add('active');
              
              // Esconder todos os conteúdos
              const contents = document.querySelectorAll('.tab-content');
              contents.forEach(content => content.classList.remove('active'));
              
              // Mostrar conteúdo correspondente
              const tabId = tab.getAttribute('data-tab');
              document.getElementById(`${tabId}-content`).classList.add('active');
            });
          });
          
          // Configurar seletor de ícones
          const selectedIcon = document.getElementById('selected-icon');
          const iconInput = document.getElementById('category-icon');
          const iconGrid = document.getElementById('icon-grid');
          
          selectedIcon.addEventListener('click', () => {
            iconGrid.classList.toggle('show');
          });
          
          const iconItems = iconGrid.querySelectorAll('.icon-item');
          iconItems.forEach(item => {
            item.addEventListener('click', () => {
              const icon = item.getAttribute('data-icon');
              iconInput.value = icon;
              selectedIcon.innerHTML = `<i class="fas ${icon}"></i>`;
              iconGrid.classList.remove('show');
            });
          });
          
          // Esconder grid de ícones quando clicar fora
          document.addEventListener('click', (event) => {
            if (!selectedIcon.contains(event.target) && !iconGrid.contains(event.target)) {
              iconGrid.classList.remove('show');
            }
          });
          
          // Configurar seletor de avatar
          const selectedAvatar = document.getElementById('selected-avatar');
          const avatarInput = document.getElementById('person-avatar');
          const avatarGrid = document.getElementById('avatar-grid');
          
          selectedAvatar.addEventListener('click', () => {
            avatarGrid.classList.toggle('show');
          });
          
          const avatarItems = avatarGrid.querySelectorAll('.avatar-item');
          avatarItems.forEach(item => {
            item.addEventListener('click', () => {
              const avatar = item.getAttribute('data-avatar');
              avatarInput.value = avatar;
              
              // Limpar seletor
              selectedAvatar.innerHTML = '';
              
              // Adicionar novo avatar
              const avatarElement = document.createElement('div');
              avatarElement.className = 'avatar-item';
              avatarElement.classList.add(avatar);
              
              selectedAvatar.appendChild(avatarElement);
              
              avatarGrid.classList.remove('show');
            });
          });
          
          // Esconder grid de avatares quando clicar fora
          document.addEventListener('click', (event) => {
            if (!selectedAvatar.contains(event.target) && !avatarGrid.contains(event.target)) {
              avatarGrid.classList.remove('show');
            }
          });
          
          // Configurar form do modal de categoria
          const categoryForm = document.getElementById('category-form');
          categoryForm.addEventListener('submit', async (event) => {
            event.preventDefault();
            
            // Obter valores do formulário
            const categoryId = document.getElementById('category-id').value;
            const name = document.getElementById('category-name').value.trim();
            const icon = document.getElementById('category-icon').value;
            const color = document.getElementById('category-color').value;
            
            // Validação básica
            if (!name) {
              utils.showToast("Nome da categoria é obrigatório", "error");
              return;
            }
            
            // Criar objeto de categoria
            const category = {
              name,
              icon,
              color
            };
            
            try {
              // Adicionar ou atualizar categoria
              if (categoryId) {
                await firebaseService.categories.update(categoryId, category);
              } else {
                await firebaseService.categories.add(category);
              }
              
              // Fechar modal
              const categoryModal = document.getElementById('category-modal');
              const modalOverlay = document.getElementById('modal-overlay');
              
              modalOverlay.classList.remove('active');
              categoryModal.classList.remove('active');
              
              // Recarregar módulo
              settingsModule.render();
            } catch (error) {
              console.error("Erro ao salvar categoria:", error);
            }
          });
          
          // Configurar form do modal de pessoa
          const personForm = document.getElementById('person-form');
          personForm.addEventListener('submit', async (event) => {
            event.preventDefault();
            
            // Obter valores do formulário
            const personId = document.getElementById('person-id').value;
            const name = document.getElementById('person-name').value.trim();
            const avatar = document.getElementById('person-avatar').value;
            
            // Validação básica
            if (!name) {
              utils.showToast("Nome da pessoa é obrigatório", "error");
              return;
            }
            
            // Criar objeto de pessoa
            const person = {
              name,
              avatar
            };
            
            try {
              // Adicionar ou atualizar pessoa
              if (personId) {
                await firebaseService.persons.update(personId, person);
              } else {
                await firebaseService.persons.add(person);
              }
              
              // Fechar modal
              const personModal = document.getElementById('person-modal');
              const modalOverlay = document.getElementById('modal-overlay');
              
              modalOverlay.classList.remove('active');
              personModal.classList.remove('active');
              
              // Recarregar módulo
              settingsModule.render();
            } catch (error) {
              console.error("Erro ao salvar pessoa:", error);
            }
          });
          
          // Configurar form do modal de cartão
          const cardForm = document.getElementById('card-form');
          cardForm.addEventListener('submit', async (event) => {
            event.preventDefault();
            
            // Obter valores do formulário
            const cardId = document.getElementById('card-id').value;
            const name = document.getElementById('card-name').value.trim();
            const limit = document.getElementById('card-limit').value;
            const closingDay = document.getElementById('card-closing-day').value;
            const dueDay = document.getElementById('card-due-day').value;
            const color = document.getElementById('card-color').value;
            
            // Validação básica
            if (!name) {
              utils.showToast("Nome do cartão é obrigatório", "error");
              return;
            }
            
            // Criar objeto de cartão
            const card = {
              name,
              limit,
              closingDay,
              dueDay,
              color
            };
            
            try {
              // Adicionar ou atualizar cartão
              if (cardId) {
                await firebaseService.cards.update(cardId, card);
              } else {
                await firebaseService.cards.add(card);
              }
              
              // Fechar modal
              const cardModal = document.getElementById('card-modal');
              const modalOverlay = document.getElementById('modal-overlay');
              
              modalOverlay.classList.remove('active');
              cardModal.classList.remove('active');
              
              // Recarregar módulo
              settingsModule.render();
            } catch (error) {
              console.error("Erro ao salvar cartão:", error);
            }
          });
          
        } catch (error) {
          console.error("Erro ao renderizar configurações:", error);
          const contentArea = document.querySelector('.content-area');
          contentArea.innerHTML = '<div class="error-message">Erro ao carregar configurações</div>';
        }
      }
    };
  </script>
<!-- ===== FIM: BLOCO 20 ================================ -->

<!-- ===== INÍCIO: BLOCO 21 ============================== -->
  <script>
    // Inicialização da aplicação
    const appInit = {
      // Função de inicialização
      init: async () => {
        try {
          console.log("Inicializando aplicação...");
          
          // Inicializar interface
          uiComponents.init();
          
          // Criar dados iniciais se necessário
          await appInit.createInitialData();
          
          // Carregar o módulo padrão (Dashboard)
          dashboardModule.render();
          
          console.log("Aplicação inicializada com sucesso!");
        } catch (error) {
          console.error("Erro na inicialização da aplicação:", error);
          utils.showToast("Erro ao inicializar aplicação", "error");
        }
      },
      
      // Criar dados iniciais se não existirem
      createInitialData: async () => {
        try {
          // Criar categorias iniciais se necessário
          await firebaseService.categories.createInitialCategories();
          
          // Criar pessoa inicial se necessário
          await firebaseService.persons.createInitialPerson();
          
          // Preencher selects de categoria no formulário de transação
          const categorySelect = document.getElementById('transaction-category');
          await uiComponents.loadCategoryOptions(categorySelect);
          
          // Preencher selects de pessoa no formulário de transação
          const personSelect = document.getElementById('transaction-person');
          await uiComponents.loadPersonOptions(personSelect);
          
          // Preencher selects de cartão no formulário de transação
          const cardSelect = document.getElementById('transaction-card');
          await uiComponents.loadCardOptions(cardSelect);
          
          return true;
        } catch (error) {
          console.error("Erro ao criar dados iniciais:", error);
          return false;
        }
      }
    };
    
    // Iniciar a aplicação quando o DOM estiver carregado
    document.addEventListener('DOMContentLoaded', appInit.init);
  </script>
<!-- ===== FIM: BLOCO 21 ================================ -->

<!-- ===== INÍCIO: BLOCO 22 - CSS BASE ============================== -->
  <style>
    /* Sistema de variáveis CSS */
    :root {
      /* Tipografia */
      --font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      --font-size-xs: 0.75rem;    /* 12px */
      --font-size-sm: 0.875rem;   /* 14px */
      --font-size-md: 1rem;       /* 16px */
      --font-size-lg: 1.125rem;   /* 18px */
      --font-size-xl: 1.25rem;    /* 20px */
      --font-size-2xl: 1.5rem;    /* 24px */
      --font-size-3xl: 1.875rem;  /* 30px */
      
      --font-weight-regular: 400;
      --font-weight-medium: 500;
      --font-weight-semibold: 600;
      --font-weight-bold: 700;
      
      --line-height-tight: 1.25;
      --line-height-normal: 1.5;
      --line-height-relaxed: 1.75;
      
      /* Cores - Tema Claro */
      --color-primary: #0A84FF;
      --color-primary-dark: #0060df;
      --color-primary-light: #4ca1ff;
      
      --color-success: #30D158;
      --color-success-dark: #25a345;
      --color-success-light: #59db7b;
      
      --color-danger: #FF453A;
      --color-danger-dark: #d92e24;
      --color-danger-light: #ff6c63;
      
      --color-warning: #FF9F0A;
      --color-warning-dark: #d98508;
      --color-warning-light: #ffb340;
      
      --color-info: #64D2FF;
      --color-info-dark: #4aa8cc;
      --color-info-light: #8ee0ff;
      
      --color-background: #F2F2F7;
      --color-surface: #FFFFFF;
      --color-surface-variant: #F9F9F9;
      
      --color-text-primary: #000000;
      --color-text-secondary: #464646;
      --color-text-tertiary: #767676;
      --color-text-disabled: #ABABAB;
      
      --color-border: #DDDDDD;
      --color-border-light: #EEEEEE;
      
      /* Espaçamentos */
      --spacing-xs: 0.25rem;   /* 4px */
      --spacing-sm: 0.5rem;    /* 8px */
      --spacing-md: 1rem;      /* 16px */
      --spacing-lg: 1.5rem;    /* 24px */
      --spacing-xl: 2rem;      /* 32px */
      --spacing-2xl: 3rem;     /* 48px */
      
      /* Bordas */
      --border-radius-sm: 0.25rem;   /* 4px */
      --border-radius-md: 0.5rem;    /* 8px */
      --border-radius-lg: 0.75rem;   /* 12px */
      --border-radius-xl: 1rem;      /* 16px */
      --border-radius-2xl: 1.5rem;   /* 24px */
      --border-radius-full: 9999px;
      
      /* Sombras */
      --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
      --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.05), 0 1px 3px rgba(0, 0, 0, 0.1);
      --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.05), 0 4px 6px rgba(0, 0, 0, 0.05);
      --shadow-xl: 0 20px 25px rgba(0, 0, 0, 0.05), 0 10px 10px rgba(0, 0, 0, 0.02);
      
      /* Transições */
      --transition-fast: 0.15s ease;
      --transition-normal: 0.25s ease;
      --transition-slow: 0.4s ease;
      
      /* Z-index */
      --z-index-dropdown: 1000;
      --z-index-sticky: 1020;
      --z-index-fixed: 1030;
      --z-index-modal-backdrop: 1040;
      --z-index-modal: 1050;
      --z-index-popover: 1060;
      --z-index-tooltip: 1070;
      
      /* Tamanhos de layout */
      --header-height: 4rem;
      --sidebar-width: 250px;
      --sidebar-width-collapsed: 4rem;
    }

    /* Tema Escuro */
    [data-theme="dark"] {
      --color-primary: #0A84FF;
      --color-primary-dark: #0060df;
      --color-primary-light: #4ca1ff;
      
      --color-success: #30D158;
      --color-success-dark: #25a345;
      --color-success-light: #59db7b;
      
      --color-danger: #FF453A;
      --color-danger-dark: #d92e24;
      --color-danger-light: #ff6c63;
      
      --color-warning: #FF9F0A;
      --color-warning-dark: #d98508;
      --color-warning-light: #ffb340;
      
      --color-info: #64D2FF;
      --color-info-dark: #4aa8cc;
      --color-info-light: #8ee0ff;
      
      --color-background: #1C1C1E;
      --color-surface: #2C2C2E;
      --color-surface-variant: #3A3A3C;
      
      --color-text-primary: #FFFFFF;
      --color-text-secondary: #EBEBF5;
      --color-text-tertiary: #AEAEB2;
      --color-text-disabled: #636366;
      
      --color-border: #3A3A3C;
      --color-border-light: #444446;
      
      --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.3);
      --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.3), 0 1px 3px rgba(0, 0, 0, 0.4);
      --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.3), 0 4px 6px rgba(0, 0, 0, 0.2);
      --shadow-xl: 0 20px 25px rgba(0, 0, 0, 0.3), 0 10px 10px rgba(0, 0, 0, 0.2);
    }

    /* Reset e estilos base */
    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html {
      font-size: 16px;
      height: 100%;
    }

    body {
      font-family: var(--font-family);
      font-size: var(--font-size-md);
      line-height: var(--line-height-normal);
      color: var(--color-text-primary);
      background-color: var(--color-background);
      height: 100%;
      overflow-x: hidden;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      transition: background-color var(--transition-normal);
    }

    h1, h2, h3, h4, h5, h6 {
      font-weight: var(--font-weight-semibold);
      line-height: var(--line-height-tight);
      margin-bottom: var(--spacing-md);
    }

    h1 {
      font-size: var(--font-size-3xl);
    }

    h2 {
      font-size: var(--font-size-2xl);
    }

    h3 {
      font-size: var(--font-size-xl);
    }

    h4 {
      font-size: var(--font-size-lg);
    }

    p {
      margin-bottom: var(--spacing-md);
    }

    a {
      color: var(--color-primary);
      text-decoration: none;
      transition: color var(--transition-fast);
    }

    a:hover {
      color: var(--color-primary-dark);
    }

    ul, ol {
      list-style-position: inside;
      margin-bottom: var(--spacing-md);
    }

    img {
      max-width: 100%;
      height: auto;
    }

    button, input, select, textarea {
      font-family: inherit;
      font-size: inherit;
      line-height: inherit;
    }
  </style>
<!-- ===== FIM: BLOCO 22 - CSS BASE ================================ -->

<!-- ===== INÍCIO: BLOCO 23 - CSS LAYOUT ============================== -->
  <style>
    /* Layout principal */
    .app-container {
      display: flex;
      height: 100%;
      position: relative;
      overflow: hidden;
    }

    /* Barra lateral */
    .sidebar {
      background-color: var(--color-surface);
      width: var(--sidebar-width);
      height: 100%;
      box-shadow: var(--shadow-md);
      transition: transform var(--transition-normal), width var(--transition-normal);
      z-index: var(--z-index-fixed);
      overflow-y: auto;
      flex-shrink: 0;
      display: flex;
      flex-direction: column;
    }

    @media (max-width: 768px) {
      .sidebar {
        position: absolute;
        left: 0;
        top: 0;
        transform: translateX(-100%);
        z-index: var(--z-index-fixed);
      }
      
      .sidebar.open {
        transform: translateX(0);
      }
    }

    .sidebar-header {
      padding: var(--spacing-md);
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid var(--color-border-light);
    }

    .app-title {
      font-size: var(--font-size-lg);
      margin-bottom: 0;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .theme-toggle-btn {
      background: transparent;
      border: none;
      color: var(--color-text-secondary);
      cursor: pointer;
      font-size: var(--font-size-md);
      padding: var(--spacing-xs);
      border-radius: var(--border-radius-full);
      transition: background-color var(--transition-fast), color var(--transition-fast);
    }

    .theme-toggle-btn:hover {
      background-color: var(--color-surface-variant);
      color: var(--color-text-primary);
    }

    .sidebar-nav {
      flex: 1;
      padding: var(--spacing-md) 0;
    }

    .nav-menu {
      list-style: none;
      margin: 0;
      padding: 0;
    }

    .nav-item {
      display: flex;
      align-items: center;
      padding: var(--spacing-md) var(--spacing-lg);
      color: var(--color-text-secondary);
      cursor: pointer;
      transition: background-color var(--transition-fast), color var(--transition-fast);
    }

    .nav-item:hover {
      background-color: var(--color-surface-variant);
      color: var(--color-text-primary);
    }

    .nav-item.active {
      background-color: var(--color-primary);
      color: white;
    }

    .nav-item i {
      margin-right: var(--spacing-md);
      font-size: var(--font-size-md);
      width: 1.25rem;
      text-align: center;
    }

    /* Conteúdo principal */
    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      height: 100%;
      overflow: hidden;
    }

    .content-header {
      height: var(--header-height);
      background-color: var(--color-surface);
      box-shadow: var(--shadow-sm);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 var(--spacing-lg);
      z-index: var(--z-index-sticky);
    }

    .header-left {
      display: flex;
      align-items: center;
    }

    .header-filters {
      display: flex;
      align-items: center;
      gap: var(--spacing-md);
    }

    .header-actions {
      display: flex;
      align-items: center;
    }

    .toggle-sidebar-btn {
      display: none;
      background: transparent;
      border: none;
      color: var(--color-text-secondary);
      cursor: pointer;
      font-size: var(--font-size-md);
      margin-right: var(--spacing-md);
      padding: var(--spacing-xs);
      border-radius: var(--border-radius-full);
      transition: background-color var(--transition-fast), color var(--transition-fast);
    }

    .toggle-sidebar-btn:hover {
      background-color: var(--color-surface-variant);
      color: var(--color-text-primary);
    }

    @media (max-width: 768px) {
      .toggle-sidebar-btn {
        display: flex;
      }
      
      .header-filters {
        display: none;
      }
      
      .content-header {
        padding: 0 var(--spacing-md);
      }
    }

    .content-header h2 {
      margin-bottom: 0;
    }

    .content-area {
      flex: 1;
      overflow-y: auto;
      padding: var(--spacing-lg);
      display: flex;
      flex-direction: column;
    }

    @media (max-width: 768px) {
      .content-area {
        padding: var(--spacing-md);
      }
    }

    /* Loading spinner */
    .loading-spinner {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100%;
      width: 100%;
      min-height: 200px;
    }

    .loading-spinner i {
      font-size: 2rem;
      color: var(--color-primary);
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Error message */
    .error-message {
      padding: var(--spacing-lg);
      background-color: var(--color-danger-light);
      color: var(--color-danger-dark);
      border-radius: var(--border-radius-md);
      margin: var(--spacing-lg) 0;
      text-align: center;
    }

    /* Empty message */
    .empty-message {
      padding: var(--spacing-lg);
      background-color: var(--color-surface-variant);
      color: var(--color-text-secondary);
      border-radius: var(--border-radius-md);
      margin: var(--spacing-lg) 0;
      text-align: center;
    }
  </style>
<!-- ===== FIM: BLOCO 23 - CSS LAYOUT ================================ -->

<!-- ===== INÍCIO: BLOCO 24 - CSS COMPONENTES ============================== -->
  <style>
    /* Botões */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: var(--spacing-sm) var(--spacing-md);
      border-radius: var(--border-radius-md);
      font-weight: var(--font-weight-medium);
      cursor: pointer;
      transition: background-color var(--transition-fast), color var(--transition-fast), border-color var(--transition-fast), transform var(--transition-fast);
      border: none;
      outline: none;
    }

    .btn:active {
      transform: translateY(1px);
    }

    .btn i {
      margin-right: var(--spacing-sm);
    }

    .btn-primary {
      background-color: var(--color-primary);
      color: white;
    }

    .btn-primary:hover {
      background-color: var(--color-primary-dark);
    }

    .btn-secondary {
      background-color: var(--color-surface-variant);
      color: var(--color-text-primary);
    }

    .btn-secondary:hover {
      background-color: var(--color-border-light);
    }

    .btn-success {
      background-color: var(--color-success);
      color: white;
    }

    .btn-success:hover {
      background-color: var(--color-success-dark);
    }

    .btn-danger {
      background-color: var(--color-danger);
      color: white;
    }

    .btn-danger:hover {
      background-color: var(--color-danger-dark);
    }

    .btn-warning {
      background-color: var(--color-warning);
      color: white;
    }

    .btn-warning:hover {
      background-color: var(--color-warning-dark);
    }

    .btn-info {
      background-color: var(--color-info);
      color: white;
    }

    .btn-info:hover {
      background-color: var(--color-info-dark);
    }

    .btn-sm {
      padding: var(--spacing-xs) var(--spacing-sm);
      font-size: var(--font-size-sm);
    }

    .btn-lg {
      padding: var(--spacing-md) var(--spacing-lg);
      font-size: var(--font-size-lg);
    }

    /* Formulários */
    .form-group {
      margin-bottom: var(--spacing-md);
    }

    .form-row {
      display: flex;
      gap: var(--spacing-md);
      margin-bottom: var(--spacing-md);
    }

    @media (max-width: 768px) {
      .form-row {
        flex-direction: column;
        gap: var(--spacing-sm);
      }
    }

    .form-group label {
      display: block;
      margin-bottom: var(--spacing-xs);
      color: var(--color-text-secondary);
      font-size: var(--font-size-sm);
    }

    .form-group input[type="text"],
    .form-group input[type="number"],
    .form-group input[type="date"],
    .form-group input[type="email"],
    .form-group input[type="password"],
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: var(--spacing-sm) var(--spacing-md);
      border: 1px solid var(--color-border);
      border-radius: var(--border-radius-md);
      background-color: var(--color-surface);
      color: var(--color-text-primary);
      transition: border-color var(--transition-fast), box-shadow var(--transition-fast);
    }

    .form-group input[type="text"]:focus,
    .form-group input[type="number"]:focus,
    .form-group input[type="date"]:focus,
    .form-group input[type="email"]:focus,
    .form-group input[type="password"]:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: var(--color-primary);
      box-shadow: 0 0 0 2px rgba(10, 132, 255, 0.1);
    }

    .form-group textarea {
      min-height: 100px;
      resize: vertical;
    }

    .form-group input[type="color"] {
      width: 100%;
      height: 40px;
      padding: 2px;
      border: 1px solid var(--color-border);
      border-radius: var(--border-radius-md);
      background-color: var(--color-surface);
    }

    .form-actions {
      display: flex;
      justify-content: flex-end;
      gap: var(--spacing-md);
      margin-top: var(--spacing-lg);
    }

    .checkbox-container {
      display: flex;
      align-items: center;
    }

    .checkbox-container input[type="checkbox"] {
      margin-right: var(--spacing-sm);
    }

    .filter-group {
      position: relative;
    }

    .filter-select {
      appearance: none;
      padding-right: 2.5rem;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23464646' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 0.5rem center;
      background-size: 1.25rem;
    }

    /* Cards */
    .card {
      background-color: var(--color-surface);
      border-radius: var(--border-radius-lg);
      box-shadow: var(--shadow-md);
      overflow: hidden;
      margin-bottom: var(--spacing-lg);
      transition: transform var(--transition-normal), box-shadow var(--transition-normal);
    }

    .card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }

    .card-header {
      padding: var(--spacing-md) var(--spacing-lg);
      border-bottom: 1px solid var(--color-border-light);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .card-header h3 {
      margin-bottom: 0;
    }

    .card-body {
      padding: var(--spacing-lg);
    }

    .card-footer {
      padding: var(--spacing-md) var(--spacing-lg);
      border-top: 1px solid var(--color-border-light);
      display: flex;
      align-items: center;
      justify-content: flex-end;
    }

    /* Grid para dashboard */
    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: var(--spacing-lg);
      margin-bottom: var(--spacing-xl);
    }

    @media (max-width: 768px) {
      .dashboard-grid {
        grid-template-columns: 1fr;
      }
    }

    /* KPI Card */
    .kpi-card {
      display: flex;
      flex-direction: column;
      padding: var(--spacing-lg);
      background-color: var(--color-surface);
      border-radius: var(--border-radius-lg);
      box-shadow: var(--shadow-md);
      transition: transform var(--transition-normal), box-shadow var(--transition-normal);
    }

    .kpi-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }

    .kpi-title {
      font-size: var(--font-size-sm);
      color: var(--color-text-secondary);
      margin-bottom: var(--spacing-sm);
    }

    .kpi-value {
      font-size: var(--font-size-2xl);
      font-weight: var(--font-weight-bold);
      margin-bottom: var(--spacing-sm);
    }

    .kpi-details {
      margin-top: auto;
      font-size: var(--font-size-sm);
      color: var(--color-text-tertiary);
      display: flex;
      align-items: center;
    }

    .kpi-details i {
      margin-right: var(--spacing-xs);
    }

    .kpi-positive {
      color: var(--color-success);
    }

    .kpi-negative {
      color: var(--color-danger);
    }

    /* Gráficos */
    .chart-container {
      width: 100%;
      height: 300px;
      margin-bottom: var(--spacing-lg);
      background-color: var(--color-surface);
      border-radius: var(--border-radius-lg);
      padding: var(--spacing-lg);
      box-shadow: var(--shadow-md);
    }

    .charts-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
      gap: var(--spacing-lg);
      margin-bottom: var(--spacing-xl);
    }

    @media (max-width: 768px) {
      .charts-grid {
        grid-template-columns: 1fr;
      }
    }

    .empty-chart-message {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 300px;
      color: var(--color-text-tertiary);
      text-align: center;
      font-style: italic;
    }

    /* Tabelas */
    .table-container {
      width: 100%;
      overflow-x: auto;
      margin-bottom: var(--spacing-lg);
      background-color: var(--color-surface);
      border-radius: var(--border-radius-lg);
      box-shadow: var(--shadow-md);
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th, td {
      padding: var(--spacing-sm) var(--spacing-md);
      text-align: left;
      border-bottom: 1px solid var(--color-border-light);
    }

    th {
      background-color: var(--color-surface-variant);
      font-weight: var(--font-weight-semibold);
      position: sticky;
      top: 0;
      z-index: 1;
    }

    tr:hover {
      background-color: var(--color-surface-variant);
    }

    .table-action-buttons {
      display: flex;
      gap: var(--spacing-xs);
    }

    .table-action-btn {
      background: transparent;
      border: none;
      color: var(--color-text-secondary);
      cursor: pointer;
      font-size: var(--font-size-md);
      padding: var(--spacing-xs);
      border-radius: var(--border-radius-sm);
      transition: background-color var(--transition-fast), color var(--transition-fast);
    }

    .table-action-btn:hover {
      background-color: var(--color-surface-variant);
      color: var(--color-primary);
    }

    /* Estilização para valores positivos/negativos */
    .income-amount, .positive-amount {
      color: var(--color-success);
      font-weight: var(--font-weight-medium);
    }

    .expense-amount, .negative-amount {
      color: var(--color-danger);
      font-weight: var(--font-weight-medium);
    }

    /* Seções */
    .dashboard-section {
      margin-bottom: var(--spacing-xl);
    }

    /* Alertas */
    .alerts-container {
      margin-bottom: var(--spacing-lg);
    }

    .alert {
      padding: var(--spacing-md) var(--spacing-lg);
      border-radius: var(--border-radius-md);
      margin-bottom: var(--spacing-md);
      display: flex;
      align-items: center;
    }

    .alert i {
      margin-right: var(--spacing-md);
      font-size: var(--font-size-lg);
    }

    .alert-success {
      background-color: rgba(48, 209, 88, 0.1);
      color: var(--color-success-dark);
      border-left: 4px solid var(--color-success);
    }

    .alert-danger {
      background-color: rgba(255, 69, 58, 0.1);
      color: var(--color-danger-dark);
      border-left: 4px solid var(--color-danger);
    }

    .alert-warning {
      background-color: rgba(255, 159, 10, 0.1);
      color: var(--color-warning-dark);
      border-left: 4px solid var(--color-warning);
    }

    .alert-info {
      background-color: rgba(100, 210, 255, 0.1);
      color: var(--color-info-dark);
      border-left: 4px solid var(--color-info);
    }
  </style>
<!-- ===== FIM: BLOCO 24 - CSS COMPONENTES ================================ -->

<!-- ===== INÍCIO: BLOCO 25 - CSS MÓDULOS ESPECÍFICOS ============================== -->
  <style>
    /* Estilos específicos de módulos */
    
    /* Análise Mensal */
    .monthly-summary-section {
      margin-bottom: var(--spacing-xl);
    }

    .summary-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: var(--spacing-md);
      margin-bottom: var(--spacing-lg);
    }

    .summary-card {
      background-color: var(--color-surface);
      border-radius: var(--border-radius-md);
      padding: var(--spacing-md);
      box-shadow: var(--shadow-md);
      display: flex;
      flex-direction: column;
    }

    .income-card {
      border-left: 4px solid var(--color-success);
    }

    .expense-card {
      border-left: 4px solid var(--color-danger);
    }

    .positive-card {
      border-left: 4px solid var(--color-success);
    }

    .negative-card {
      border-left: 4px solid var(--color-danger);
    }

    .summary-title {
      font-size: var(--font-size-sm);
      color: var(--color-text-secondary);
      margin-bottom: var(--spacing-xs);
    }

    .summary-value {
      font-size: var(--font-size-xl);
      font-weight: var(--font-weight-bold);
    }

    .filters-section {
      margin-bottom: var(--spacing-xl);
      background-color: var(--color-surface);
      border-radius: var(--border-radius-lg);
      padding: var(--spacing-lg);
      box-shadow: var(--shadow-md);
    }

    .filters-form {
      display: flex;
      flex-wrap: wrap;
      gap: var(--spacing-md);
      align-items: flex-end;
    }

    .filters-form .filter-group {
      flex: 1;
      min-width: 200px;
    }

    @media (max-width: 768px) {
      .filters-form {
        flex-direction: column;
      }
      
      .filters-form .filter-group {
        width: 100%;
      }
    }

    .filters-form button {
      margin-top: var(--spacing-md);
    }

    .custom-period-group {
      display: flex;
      gap: var(--spacing-md);
    }

    .date-input-group {
      flex: 1;
    }

    /* Metas Financeiras */
    .add-goal-section {
      margin-bottom: var(--spacing-xl);
      display: flex;
      justify-content: flex-end;
    }

    .goals-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: var(--spacing-lg);
      margin-bottom: var(--spacing-xl);
    }

    @media (max-width: 768px) {
      .goals-grid {
        grid-template-columns: 1fr;
      }
    }

    .goal-card {
      background-color: var(--color-surface);
      border-radius: var(--border-radius-lg);
      box-shadow: var(--shadow-md);
      overflow: hidden;
      transition: transform var(--transition-normal), box-shadow var(--transition-normal);
    }

    .goal-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }

    .goal-card-header {
      padding: var(--spacing-md) var(--spacing-lg);
      display: flex;
      align-items: center;
      border-bottom: 1px solid var(--color-border-light);
    }

    .goal-icon {
      width: 40px;
      height: 40px;
      border-radius: var(--border-radius-full);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: var(--spacing-md);
      flex-shrink: 0;
    }

    .goal-icon i {
      color: white;
      font-size: var(--font-size-lg);
    }

    .goal-header-info {
      flex: 1;
      min-width: 0;
    }

    .goal-name {
      font-size: var(--font-size-lg);
      margin: 0;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .goal-person {
      font-size: var(--font-size-sm);
      color: var(--color-text-secondary);
    }

    .goal-card-actions {
      display: flex;
      gap: var(--spacing-xs);
      margin-left: auto;
    }

    .card-action-btn {
      background: transparent;
      border: none;
      color: var(--color-text-secondary);
      cursor: pointer;
      font-size: var(--font-size-md);
      padding: var(--spacing-xs);
      border-radius: var(--border-radius-sm);
      transition: background-color var(--transition-fast), color var(--transition-fast);
    }

    .card-action-btn:hover {
      background-color: var(--color-surface-variant);
      color: var(--color-primary);
    }

    .goal-card-body {
      padding: var(--spacing-lg);
    }

    .goal-progress-container {
      margin-bottom: var(--spacing-lg);
    }

    .goal-progress-bar {
      height: 10px;
      background-color: var(--color-border-light);
      border-radius: var(--border-radius-full);
      overflow: hidden;
      position: relative;
      margin-bottom: var(--spacing-xs);
    }

    .goal-progress-fill {
      height: 100%;
      border-radius: var(--border-radius-full);
      transition: width var(--transition-normal);
    }

    .goal-progress-label {
      position: absolute;
      top: 50%;
      right: var(--spacing-sm);
      transform: translateY(-50%);
      font-size: var(--font-size-xs);
      color: var(--color-text-tertiary);
      font-weight: var(--font-weight-medium);
    }

    .goal-details {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: var(--spacing-md);
      margin-bottom: var(--spacing-lg);
    }

    .goal-detail {
      display: flex;
      flex-direction: column;
    }

    .goal-detail-label {
      font-size: var(--font-size-sm);
      color: var(--color-text-tertiary);
      margin-bottom: var(--spacing-xs);
    }

    .goal-detail-value {
      font-weight: var(--font-weight-medium);
    }

    .goal-purpose {
      margin-top: var(--spacing-md);
      border-top: 1px solid var(--color-border-light);
      padding-top: var(--spacing-md);
    }

    .goal-purpose-label {
      font-size: var(--font-size-sm);
      color: var(--color-text-tertiary);
      margin-bottom: var(--spacing-xs);
      display: block;
    }

    .goal-purpose-value {
      margin: 0;
      font-size: var(--font-size-sm);
      color: var(--color-text-secondary);
    }

    .goal-card-footer {
      padding: var(--spacing-md) var(--spacing-lg);
      border-top: 1px solid var(--color-border-light);
    }

    .goal-card-footer h5 {
      font-size: var(--font-size-sm);
      margin-bottom: var(--spacing-sm);
    }

    .contributions-list {
      list-style: none;
      margin: 0;
      padding: 0;
    }

    .contribution-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--spacing-xs) 0;
      border-bottom: 1px solid var(--color-border-light);
    }

    .contribution-date {
      font-size: var(--font-size-sm);
      color: var(--color-text-secondary);
    }

    .contribution-amount {
      font-weight: var(--font-weight-medium);
      color: var(--color-success);
    }

    .contribution-delete-btn {
      background: transparent;
      border: none;
      color: var(--color-text-tertiary);
      cursor: pointer;
      font-size: var(--font-size-sm);
      padding: var(--spacing-xs);
      border-radius: var(--border-radius-sm);
      transition: color var(--transition-fast);
    }

    .contribution-delete-btn:hover {
      color: var(--color-danger);
    }

    .view-all-contributions-btn {
      background: transparent;
      border: none;
      color: var(--color-primary);
      cursor: pointer;
      font-size: var(--font-size-sm);
      padding: var(--spacing-sm) 0;
      width: 100%;
      text-align: center;
      transition: color var(--transition-fast);
      margin-top: var(--spacing-sm);
    }

    .view-all-contributions-btn:hover {
      color: var(--color-primary-dark);
      text-decoration: underline;
    }

    /* Configurações */
    .settings-container {
      display: flex;
      flex-direction: column;
    }

    .tabs-container {
      margin-bottom: var(--spacing-lg);
    }

    .tabs-list {
      display: flex;
      list-style: none;
      margin: 0;
      padding: 0;
      border-bottom: 1px solid var(--color-border);
    }

    .tab {
      padding: var(--spacing-md) var(--spacing-lg);
      cursor: pointer;
      transition: color var(--transition-fast), border-bottom var(--transition-fast);
      color: var(--color-text-secondary);
      border-bottom: 2px solid transparent;
    }

    .tab:hover {
      color: var(--color-text-primary);
    }

    .tab.active {
      color: var(--color-primary);
      border-bottom: 2px solid var(--color-primary);
      font-weight: var(--font-weight-medium);
    }

    .tab-content {
      display: none;
      padding: var(--spacing-lg) 0;
    }

    .tab-content.active {
      display: block;
    }

    .tab-content-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing-lg);
    }

    .settings-table {
      width: 100%;
      border-collapse: collapse;
      background-color: var(--color-surface);
      border-radius: var(--border-radius-lg);
      box-shadow: var(--shadow-md);
    }

    .color-indicator {
      width: 20px;
      height: 20px;
      border-radius: var(--border-radius-full);
    }

    .icon-selector,
    .avatar-selector {
      position: relative;
    }

    .selected-icon,
    .selected-avatar {
      width: 40px;
      height: 40px;
      border-radius: var(--border-radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      background-color: var(--color-surface-variant);
      transition: background-color var(--transition-fast);
    }

    .selected-icon:hover,
    .selected-avatar:hover {
      background-color: var(--color-border-light);
    }

    .icon-grid,
    .avatar-grid {
      display: none;
      position: absolute;
      top: 100%;
      left: 0;
      background-color: var(--color-surface);
      border: 1px solid var(--color-border);
      border-radius: var(--border-radius-md);
      box-shadow: var(--shadow-lg);
      z-index: var(--z-index-dropdown);
      padding: var(--spacing-md);
      margin-top: var(--spacing-sm);
      grid-template-columns: repeat(5, 1fr);
      gap: var(--spacing-md);
      width: 280px;
    }

    .icon-grid.show,
    .avatar-grid.show {
      display: grid;
    }

    .icon-item {
      width: 40px;
      height: 40px;
      border-radius: var(--border-radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: background-color var(--transition-fast);
      background-color: var(--color-surface-variant);
    }

    .icon-item:hover {
      background-color: var(--color-border-light);
    }

    .avatar-item {
      width: 40px;
      height: 40px;
      border-radius: var(--border-radius-full);
      cursor: pointer;
      background-color: var(--color-primary);
      background-size: cover;
      background-position: center;
    }

    .avatar-1 { background-color: #0A84FF; }
    .avatar-2 { background-color: #30D158; }
    .avatar-3 { background-color: #FF453A; }
    .avatar-4 { background-color: #FF9F0A; }
    .avatar-5 { background-color: #5E5CE6; }
    .avatar-6 { background-color: #BF5AF2; }
    .avatar-7 { background-color: #64D2FF; }
    .avatar-8 { background-color: #FF375F; }

    .avatar {
      width: 30px;
      height: 30px;
      border-radius: var(--border-radius-full);
      background-size: cover;
      background-position: center;
    }
  </style>
<!-- ===== FIM: BLOCO 25 - CSS MÓDULOS ESPECÍFICOS ================================ -->

<!-- ===== INÍCIO: BLOCO 26 - CSS MODAIS E NOTIFICAÇÕES ============================== -->
  <style>
    /* Modais */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: var(--z-index-modal-backdrop);
      backdrop-filter: blur(4px);
    }

    .modal-overlay.active {
      display: block;
    }

    .modal {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.9);
      width: 90%;
      max-width: 600px;
      max-height: 90vh;
      background-color: var(--color-surface);
      border-radius: var(--border-radius-lg);
      z-index: var(--z-index-modal);
      box-shadow: var(--shadow-xl);
      opacity: 0;
      transition: opacity var(--transition-normal), transform var(--transition-normal);
      overflow: hidden;
    }

    .modal.active {
      display: block;
      opacity: 1;
      transform: translate(-50%, -50%) scale(1);
    }

    .modal-content {
      display: flex;
      flex-direction: column;
      height: 100%;
      max-height: 90vh;
    }

    .modal-header {
      padding: var(--spacing-md) var(--spacing-lg);
      border-bottom: 1px solid var(--color-border-light);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .modal-header h3 {
      margin: 0;
    }

    .close-modal {
      background: transparent;
      border: none;
      font-size: var(--font-size-xl);
      color: var(--color-text-secondary);
      cursor: pointer;
      transition: color var(--transition-fast);
    }

    .close-modal:hover {
      color: var(--color-danger);
    }

    .modal-body {
      padding: var(--spacing-lg);
      overflow-y: auto;
      flex: 1;
    }

    /* Dialogs */
    .dialog {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.9);
      width: 90%;
      max-width: 400px;
      background-color: var(--color-surface);
      border-radius: var(--border-radius-lg);
      z-index: var(--z-index-modal);
      box-shadow: var(--shadow-xl);
      opacity: 0;
      transition: opacity var(--transition-normal), transform var(--transition-normal);
    }

    .dialog.active {
      display: block;
      opacity: 1;
      transform: translate(-50%, -50%) scale(1);
    }

    .dialog-content {
      padding: var(--spacing-lg);
    }

    .dialog-header {
      margin-bottom: var(--spacing-md);
    }

    .dialog-header h3 {
      margin: 0;
    }

    .dialog-body {
      margin-bottom: var(--spacing-lg);
    }

    .dialog-actions {
      display: flex;
      justify-content: flex-end;
      gap: var(--spacing-md);
    }

    /* Toast notifications */
    .toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      min-width: 300px;
      max-width: 400px;
      background-color: var(--color-surface);
      border-radius: var(--border-radius-lg);
      box-shadow: var(--shadow-lg);
      overflow: hidden;
      z-index: var(--z-index-tooltip);
      opacity: 0;
      transform: translateY(30px);
      transition: opacity var(--transition-normal), transform var(--transition-normal);
      pointer-events: none;
    }

    .toast.show {
      opacity: 1;
      transform: translateY(0);
      pointer-events: auto;
    }

    .toast-content {
      display: flex;
      align-items: center;
      padding: var(--spacing-md) var(--spacing-lg);
    }

    .toast-content i {
      font-size: 1.5rem;
      margin-right: var(--spacing-md);
    }

    .toast-message {
      flex: 1;
    }

    .toast-progress {
      height: 4px;
      background-color: var(--color-primary);
      animation: toast-progress 3s linear forwards;
    }

    @keyframes toast-progress {
      0% { width: 100%; }
      100% { width: 0; }
    }

    /* Animações */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes slideIn {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    .fadeIn {
      animation: fadeIn var(--transition-normal) forwards;
    }

    .slideIn {
      animation: slideIn var(--transition-normal) forwards;
    }
  </style>
<!-- ===== FIM: BLOCO 26 - CSS MODAIS E NOTIFICAÇÕES ================================ -->

<!-- ===== INÍCIO: BLOCO 27 - FECHAMENTO HTML ============================== -->
</body>
</html>
<!-- ===== FIM: BLOCO 27 - FECHAMENTO HTML ================================ -->
