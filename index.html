// App.js
import React, { useState, useEffect, useMemo } from 'react';
import './App.css';

const formatCurrency = (value) => {
  return new Intl.NumberFormat('pt-BR', {
    style: 'currency',
    currency: 'BRL',
  }).format(Number(value) || 0);
};

const generateId = () => Math.random().toString(36).substr(2, 9);

const categories = ['Moradia', 'Alimentação', 'Transporte', 'Lazer', 'Saúde', 'Educação', 'Outros'];
const people = ['Wagner', 'Bárbara', 'Joaquim', 'Família'];

function App() {
  const [expenses, setExpenses] = useState(() => {
    const saved = localStorage.getItem('expenses');
    return saved ? JSON.parse(saved) : [];
  });

  const [form, setForm] = useState({
    id: '',
    date: '',
    description: '',
    category: '',
    amount: '',
    person: '',
  });

  const [editing, setEditing] = useState(false);

  useEffect(() => {
    localStorage.setItem('expenses', JSON.stringify(expenses));
  }, [expenses]);

  const total = useMemo(() => {
    return expenses.reduce((sum, e) => sum + Number(e.amount), 0);
  }, [expenses]);

  const handleChange = (e) => {
    const { name, value } = e.target;
    setForm((prev) => ({ ...prev, [name]: value }));
  };

  const handleSubmit = (e) => {
    e.preventDefault();
    if (!form.date || !form.description || !form.category || !form.amount || !form.person) return;

    const newExpense = {
      ...form,
      id: editing ? form.id : generateId(),
      amount: Number(form.amount),
    };

    setExpenses((prev) => {
      if (editing) {
        return prev.map((e) => (e.id === form.id ? newExpense : e));
      } else {
        return [...prev, newExpense];
      }
    });

    setForm({ id: '', date: '', description: '', category: '', amount: '', person: '' });
    setEditing(false);
  };

  const handleEdit = (expense) => {
    setForm(expense);
    setEditing(true);
  };

  const handleDelete = (id) => {
    setExpenses((prev) => prev.filter((e) => e.id !== id));
  };

  return (
    <div className="container">
      <h1>Despesas da Família</h1>

      <form onSubmit={handleSubmit} className="form">
        <input name="date" type="date" value={form.date} onChange={handleChange} required />
        <input name="description" placeholder="Descrição" value={form.description} onChange={handleChange} required />
        <select name="category" value={form.category} onChange={handleChange} required>
          <option value="">Categoria</option>
          {categories.map((cat) => (
            <option key={cat} value={cat}>{cat}</option>
          ))}
        </select>
        <input name="amount" type="number" placeholder="Valor" value={form.amount} onChange={handleChange} required />
        <select name="person" value={form.person} onChange={handleChange} required>
          <option value="">Pessoa</option>
          {people.map((p) => (
            <option key={p} value={p}>{p}</option>
          ))}
        </select>
        <button type="submit">{editing ? 'Atualizar' : 'Adicionar'}</button>
      </form>

      <h2>Total: {formatCurrency(total)}</h2>

      <table className="table">
        <thead>
          <tr>
            <th>Data</th>
            <th>Descrição</th>
            <th>Categoria</th>
            <th>Valor</th>
            <th>Pessoa</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody>
          {expenses.map((exp) => (
            <tr key={exp.id}>
              <td>{exp.date}</td>
              <td>{exp.description}</td>
              <td>{exp.category}</td>
              <td>{formatCurrency(exp.amount)}</td>
              <td>{exp.person}</td>
              <td>
                <button onClick={() => handleEdit(exp)}>Editar</button>
                <button onClick={() => handleDelete(exp.id)}>Excluir</button>
              </td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  );
}

export default App;
